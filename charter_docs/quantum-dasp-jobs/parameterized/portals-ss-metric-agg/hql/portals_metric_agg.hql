USE ${env:DASP_db};

set mapreduce.input.fileinputformat.split.maxsize=5368709120;
set mapreduce.input.fileinputformat.split.minsize=5368709120;
set hive.optimize.sort.dynamic.partition=false;
set hive.exec.dynamic.partition.mode=nonstrict;
set orc.force.positional.evolution=true;
SET hive.merge.tezfiles=true;
set hive.merge.smallfiles.avgsize=2048000000;
set hive.merge.size.per.task=2048000000;

ADD JAR s3://pi-global-${env:ENVIRONMENT}-udf-jars/epoch-1.0-SNAPSHOT.jar;
CREATE TEMPORARY FUNCTION epoch_converter AS 'Epoch_To_Denver';

INSERT OVERWRITE TABLE quantum_metric_agg_portals PARTITION (denver_date)
SELECT
  CASE
  WHEN  visit__account__details__mso IN ('CHARTER','CHTR','"CHTR"')       THEN 'L-CHTR'
  WHEN  visit__account__details__mso IN ('TWC','"TWC"', 'NONECAPTURED')   THEN 'L-TWC'
  WHEN  visit__account__details__mso IN ('BH','BHN','"BHN"')              THEN 'L-BHN'
  WHEN (visit__account__details__mso IN ('','unknown','"NONE"', 'NONE')
        OR visit__account__details__mso IS NULL )                         THEN 'MSO-MISSING'
  ELSE visit__account__details__mso
  END AS mso,
  visit__application_details__application_type AS application_type,
  LOWER(visit__device__device_type) AS device_type,
  visit__connection__connection_type AS connection_type,
  visit__connection__network_status AS network_status,
  state__content__stream__playback_type AS playback_type,
  "cust_type" as cust_type,
  "stream_subtype" AS stream_subtype,
  IF(visit__application_details__application_type = 'Android', IF(visit__device__operating_system RLIKE '^(Android 4.0)' OR visit__device__operating_system RLIKE '^(Android 4.1)' OR visit__device__operating_system RLIKE '^(Android 4.2)' OR visit__device__operating_system RLIKE '^(Android 4.3)', 'Android 4.1 - 4.3', 'Android 4.4+'), NULL) AS android_type,
  CASE
    WHEN visit__application_details__application_type IN('iOS','Android') THEN 'Mobile'
    WHEN visit__application_details__application_type IN('Xbox','SamsungTV') THEN 'Connected Devices'
    ELSE visit__application_details__application_type
  END AS application_group_type,
  state__content__stream__playback_id AS stream_id,
  visit__visit_id AS visit_id,
  visit__device__enc_uuid AS device_id,
  visit__account__enc_account_number AS acct_id,
  NULL AS unique_stream_id,
  NULL AS unique_visit_id,
  NULL AS unique_device_id,
  NULL AS unique_account_number,
  visit__variant_uuids AS variant_uuids,
  state__content__details__episode_number AS episode_number,
  state__content__details__season_number AS season_number,
  state__content__details__genres AS genres,
  state__content__programmer__linear__channel_name AS linear_channel_name,
  visit__device__browser__name AS browser_name,
  visit__device__browser__user_agent AS browser_user_agent,
  visit__device__browser__version AS browser_version,
  state__content__identifiers__tms_program_id AS tms_program_id,

  MIN(received__timestamp) AS min_received_timestamp,
  MAX(received__timestamp) AS max_received_timestamp,

  SUM(IF(message__name = 'loginStop' AND operation__operation_type = 'manualAuth' AND operation__success = TRUE
    AND (visit__application_details__application_type != 'OVP' OR (visit__application_details__application_type = 'OVP' AND visit__application_details__app_version >= '6.1')), 1, 0)) AS manual_login_success,
  SUM(IF(message__name = 'loginStart' AND operation__operation_type = 'manualAuth'
    AND (visit__application_details__application_type != 'OVP' OR (visit__application_details__application_type = 'OVP' AND visit__application_details__app_version >= '6.1')), 1, 0)) AS manual_login_attempt,
  SUM(IF(message__name = 'loginStop' AND operation__operation_type = 'resumeAuth' AND operation__success = TRUE
    AND (visit__application_details__application_type != 'OVP' OR (visit__application_details__application_type = 'OVP' AND visit__application_details__app_version >= '6.1')), 1, 0)) AS resume_login_success,
  SUM(IF(message__name = 'loginStart' AND operation__operation_type = 'resumeAuth'
    AND (visit__application_details__application_type != 'OVP' OR (visit__application_details__application_type = 'OVP' AND visit__application_details__app_version >= '6.1')), 1, 0)) AS resume_login_attempt,
  SUM(IF(message__name = 'loginStop' AND operation__operation_type = 'verifierAuth' AND operation__success = TRUE
    AND (visit__application_details__application_type != 'OVP' OR (visit__application_details__application_type = 'OVP' AND visit__application_details__app_version >= '6.1')), 1, 0)) AS verifier_login_success,
  SUM(IF(message__name = 'loginStart' AND operation__operation_type = 'verifierAuth'
    AND (visit__application_details__application_type != 'OVP' OR (visit__application_details__application_type = 'OVP' AND visit__application_details__app_version >= '6.1')), 1, 0)) AS verifier_login_attempt,

  COLLECT_LIST(IF(message__name = 'loginStop' AND operation__operation_type = 'manualAuth'
    AND operation__success = TRUE, IF(visit__login__login_duration_ms > 15000, 15000, if(visit__login__login_duration_ms > 0,visit__login__login_duration_ms,0)), NULL)) AS manual_duration_ms_list,
  COLLECT_LIST(IF(message__name = 'loginStop' AND operation__operation_type = 'verifierAuth'
    AND operation__success = TRUE, IF(visit__login__login_duration_ms > 15000, 15000, if(visit__login__login_duration_ms > 0,visit__login__login_duration_ms,0)), NULL)) AS verifier_duration_ms_list,
  NULL AS token_exchange_attempts,
  NULL AS stream_init_failures,
  NULL AS tune_time_ms_sum,
  NULL AS tune_time_count,
  COLLECT_SET(0) AS tune_time_ms_list,
  NULL AS watch_time_ms,
  NULL AS buffering_time_ms,
  NULL AS bitrate_downshifts,
  NULL AS stream_init_starts,
  NULL AS stream_noninit_failures,
  NULL AS bandwidth_consumed_mb,
  NULL AS bitrate_content_elapsed_ms,
  NULL AS api_search_error_count,
  NULL AS keyword_search,
  NULL AS predictive_search,
  NULL AS search_closed,
  NULL AS search_entered,
  NULL AS search_entered_space,
  NULL AS search_entered_total,
  COLLECT_SET(0) AS search_response_time_ms_list,
  NULL AS search_result_selected,
  COLLECT_SET('') AS search_result_type_list,
  NULL AS search_started,
  NULL AS search_text_length,
  NULL AS zero_results,
  NULL AS zero_results_space,
  visit__account__enc_account_billing_division AS billing_division,
  visit__account__enc_account_billing_id AS billing_id,
  visit__location__enc_city AS location_city,
  visit__location__state AS location_state,
  visit__location__enc_zip_code AS location_zipcode,
  visit__application_details__app_version AS app_version,
  COLLECT_SET(0) AS complete_buffering_time_ms_list,
  COLLECT_SET(0) AS complete_manual_duration_ms_list,
  COLLECT_SET(0) AS complete_tune_time_ms_list,
  COLLECT_SET(0) AS complete_verifier_duration_ms_list,
  COLLECT_SET(0) AS complete_watch_time_ms,
  NULL AS nonactive_account_number,
  NULL AS nonactive_device_id,
  NULL AS nonactive_stream_id,
  NULL AS nonactive_visit_id,
  visit__device__model as device_model,
  NULL AS critical_api_attempts,
  NULL AS critical_api_fails,
  NULL AS application_errors,
  NULL AS critical_api_success,
  NULL AS other_api_response_count,
  'stream_choice' AS stream_choice,
  state__content__content_class AS content_class,
  visit__account__enc_account_billing_division_id AS billing_division_id,
  CONCAT(
  visit__account__enc_account_billing_division_id ,
  visit__account__enc_account_billing_division ,
  visit__account__enc_account_billing_id
  ) AS billing_combo_key,
  IF(LOWER(visit__application_details__application_name) IN('oneapp','specu','bulkmdu'), 'IPTV', LOWER(visit__application_details__application_name)) AS app_vertical,
  LOWER(visit__application_details__application_name) AS application_name,
  visit__login__logged_in AS logged_in,
  visit__device__operating_system AS operating_system,
  visit__device__device_form_factor AS form_factor,
  visit__account__details__billing_status  AS billing_status,
  visit__account__details__auto_pay_status AS autopay_status,
        SUM(IF(visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'moreServices' AND state__view__current_page__elements__ui_name = 'Voice', 1, 0)) AS portals_access_voice_platform_via_tile,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support' AND (state__view__current_page__page_url RLIKE '/support/manage-account*' OR state__view__current_page__page_url RLIKE '/support/my-account*'), 1, 0)) AS portals_account_billing_support_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'wiFiProfile', 1, 0)) AS portals_account_settings_click_install_wifi_profile,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'managePeople', 1, 0)) AS portals_account_settings_click_manage_people,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'saveContactInfo', 1, 0)) AS portals_account_settings_click_save_contact_info,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__app_section = 'account' AND state__view__current_page__page_name = 'accountHome', 1, 0)) AS portals_account_settings_home_page_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'manageContactInfo', 1, 0)) AS portals_account_settings_manage_contact_info_page_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'managePeople', 1, 0)) AS portals_account_settings_manage_people_page_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'yourInfo', 1, 0)) AS portals_account_settings_your_info_tab_views,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_failure') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot') AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot') AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')), 1, 0)) AS portals_all_equipment_reset_flow_failures,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'troubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot')), 1, 0)) AS portals_all_equipment_reset_flow_starts,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_success') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot') AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot') AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')), 1, 0)) AS portals_all_equipment_reset_flow_successes,
        SUM(IF((visit__application_details__application_name = 'SpecNet'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_campaign_accountSummaryDashboard_optIn' AND array_contains(state__view__current_page__elements__selected_options, 'paperless:true')) OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_campaign_accountSummaryDashboard_optIn' AND array_contains(state__view__current_page__elements__selected_options, 'paperless:true')), 1, 0)) AS portals_asd_paperless_enroll,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'userHome') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__page_name = 'home-authenticated') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'pageView' AND state__view__current_page__page_name = 'homeAuth'), 1, 0)) AS portals_auth_homepage_page_views,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'closingX' AND state__view__modal__name = 'paperlessBillingOffConfirmation') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'closingX' AND state__view__modal__name = 'paperlessBillingOffConfirmation'), 1, 0)) AS portals_bill_delivery_pref_exit,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'keepPaperlessBilling') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'keepPaperlessBilling'), 1, 0)) AS portals_bill_delivery_pref_keep_paperless,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paperlessManage', 1, 0)) AS portals_bill_delivery_pref_manage_paperless,
        SUM(IF((visit__application_details__application_name = 'SpecNet'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_billDelivery_getAPaperBill') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_billDelivery_getAPaperBill'), 1, 0)) AS portals_bill_delivery_pref_paper,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND state__view__current_page__page_name IN('paperlessTurnOffFailure','paperlessBillingOffFailure'), 1, 0)) AS portals_bill_delivery_pref_paper_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND state__view__current_page__page_name IN('paperlessTurnOffSuccess', 'paperlessBillingOffSuccess'), 1, 0)) AS portals_bill_delivery_pref_paper_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paperlessEnroll' AND state__view__current_page__page_name = 'userHome', 1, 0)) AS portals_bill_delivery_pref_paperless_enroll_from_homepage,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND state__view__current_page__page_name IN('paperlessTurnOnFailure', 'paperlessBillingOnFailure'), 1, 0)) AS portals_bill_delivery_pref_paperless_failure,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paperlessEnroll' AND state__view__current_page__page_name = 'paperlessBilling') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'billDeliveryToggle' AND operation__toggle_state = FALSE AND epoch_converter(received__timestamp, 'America/Denver') > '2020-04-16') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'billDeliveryToggle' AND operation__toggle_state = FALSE AND epoch_converter(received__timestamp, 'America/Denver') > '2020-04-30'), 1, 0)) AS portals_bill_delivery_pref_paperless_submit,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paperlessEnroll' AND state__view__current_page__page_name = 'paperlessBilling' AND state__view__previous_page__page_name = 'billingHome', 1, 0)) AS portals_bill_delivery_pref_paperless_submit_from_billinghome,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paperlessEnroll' AND state__view__current_page__page_name = 'paperlessBilling' AND state__view__previous_page__page_name = 'userHome', 1, 0)) AS portals_bill_delivery_pref_paperless_submit_from_homepage,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND state__view__current_page__page_name IN('paperlessTurnOnSuccess', 'paperlessBillingOnSuccess'), 1, 0)) AS portals_bill_delivery_pref_paperless_success,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing') OR (visit__application_details__application_name = 'SpecNet'  AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing'), 1, 0)) AS portals_billing_feature_interaction,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND state__view__current_page__app_section = 'billing') OR (visit__application_details__application_name = 'SpecNet'  AND message__name = 'pageView' AND state__view__current_page__app_section = 'billing') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'pageView' AND state__view__current_page__app_section = 'billing'), 1, 0)) AS portals_billing_feature_page_view,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'modalView' AND state__view__modal__name = 'newFingerprintLoginModal', 1, 0)) AS portals_biometrics_fingerprint_enroll,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('callUsButton', 'contactUs', 'contactUsCall', 'footer-contact-contactUs'), 1, 0)) AS portals_call_support,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'pauseDeviceCancel', 1, 0)) AS portals_cancel_pause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'onboardingCancel' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsthZZPBZmVsOnuyHE/xnHLI=', 1, 0)) AS portals_cancel_tutorial_equip_page_three,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'onboardingCancel' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsmctMWQ76QOVQ+A9I4OwOL4=', 1, 0)) AS portals_cancel_tutorial_otp_page_two,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'onboardingCancel' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsj4CkjWNvrJkbJOw2hClPdI=', 1, 0)) AS portals_cancel_tutorial_start_page_one,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'unpauseDeviceCancel', 1, 0)) AS portals_cancel_unpause_device,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_appointments_cancelAppt') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_appointments_cancelAppt'), 1, 0)) AS portals_cancelled_service_appointment_start,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__modal__name = 'cancelappointment-modal') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'assetDisplayed' AND message__event_case_id IN('SPECTRUM_serviceAppt_unauthCancelApptSuccess', 'SPECTRUM_assetDisplayed_appointments_cancelApptSuccess')) OR (visit__application_details__application_name = 'SMB'  AND message__name = 'assetDisplayed' AND message__event_case_id IN('SPECTRUM_serviceAppt_unauthCancelApptSuccess', 'SPECTRUM_assetDisplayed_appointments_cancelApptSuccess')), 1, 0)) AS portals_cancelled_service_appointments,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'confirmRemoveDevice', 1, 0)) AS portals_confirm_remove_device,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__page_name = 'contactUs') OR (visit__application_details__application_name = 'SMB' AND message__name = 'pageView'  AND state__view__current_page__page_name = 'Contact Us - SMB'), 1, 0)) AS portals_contact_us_page_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('experienceRatingCancel', 'customerFeedbackCancel'), 1, 0)) AS portals_csat_campaign_dismiss,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name IN('experienceRating', 'feedbackSatisfactionRating', 'feedbackForm'), 1, 0)) AS portals_csat_campaign_interaction,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'feedbackFormCancel' AND state__view__previous_page__page_name = 'experienceRating', 1, 0)) AS portals_csat_submit_feedback_cancel_written_feedback,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND (message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'experienceRatingCont' AND state__view__current_page__elements__element_int_value = 1) OR (message__name = 'userFeedback' AND message__event_case_id = 'mySpectrum_userFeedback_satisfactionRating' AND operation__user_entry__numeric = 1), 1, 0)) AS portals_csat_submit_rating_1_very_dissatisfied,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND (message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'experienceRatingCont' AND state__view__current_page__elements__element_int_value = 2) OR (message__name = 'userFeedback' AND message__event_case_id = 'mySpectrum_userFeedback_satisfactionRating' AND operation__user_entry__numeric = 2), 1, 0)) AS portals_csat_submit_rating_2_dissatisfied,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND (message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'experienceRatingCont' AND state__view__current_page__elements__element_int_value = 3) OR (message__name = 'userFeedback' AND message__event_case_id = 'mySpectrum_userFeedback_satisfactionRating' AND operation__user_entry__numeric = 3), 1, 0)) AS portals_csat_submit_rating_3_neutral,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND (message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'experienceRatingCont' AND state__view__current_page__elements__element_int_value = 4) OR (message__name = 'userFeedback' AND message__event_case_id = 'mySpectrum_userFeedback_satisfactionRating' AND operation__user_entry__numeric = 4), 1, 0)) AS portals_csat_submit_rating_4_satisfied,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND (message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'experienceRatingCont' AND state__view__current_page__elements__element_int_value = 5) OR (message__name = 'userFeedback' AND message__event_case_id = 'mySpectrum_userFeedback_satisfactionRating' AND operation__user_entry__numeric = 5), 1, 0)) AS portals_csat_submit_rating_5_very_satisfied,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND (message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'experienceRatingCont' AND state__view__current_page__elements__element_int_value IN('1', '2', '3', '4', '5')) OR (message__name = 'userFeedback' AND message__event_case_id = 'mySpectrum_userFeedback_satisfactionRating' AND operation__user_entry__numeric IN('1', '2', '3', '4', '5')), 1, 0)) AS portals_csat_submit_rating_all,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'userFeedback' AND state__view__previous_page__page_name = 'experienceRating' AND operation__user_entry__enc_feedback IS NOT NULL, 1, 0)) AS portals_csat_submit_written_feedback,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'installWiFiProfile', 1, 0)) AS portals_download_wifi_profile_button_click,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'installWiFiProfile' AND visit__application_details__application_type = 'Android', 1, 0)) AS portals_download_wifi_profile_button_click_android,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'installWiFiProfile' AND visit__application_details__application_type = 'iOS', 1, 0)) AS portals_download_wifi_profile_button_click_ios,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_Name = 'spectrumWiFiProfileResponse', 1, 0)) AS portals_download_wifi_profile_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_Name = 'spectrumWiFiProfileResponse' AND visit__application_details__application_type = 'Android', 1, 0)) AS portals_download_wifi_profile_success_android,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section IN ('tv','voice','internet') AND state__view__current_page__page_name = 'my-internet-services', 1, 0)) AS portals_ed_my_internet_services,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section IN ('tv','voice','internet') AND state__view__current_page__page_name IN ('my-internet-services.contact-us','my-voice-services'), 1, 0)) AS portals_ed_my_voice_services,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'cancelEditWifi') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageNetworkCancel') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageNetworkCancel'), 1, 0)) AS portals_equipment_cancel_edit_ssid_select_action,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'confirmWifiChange') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageNetworkSave') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageNetworkSave'), 1, 0)) AS portals_equipment_confirm_edit_ssid_select_action,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'equipDetails', 1, 0)) AS portals_equipment_detail_views,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('editWifiNetwork', 'ssidManageWifiNetworkTile', 'ssidEditWifiNetworkModal')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_equipment_manageNetwork') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_equipment_manageNetwork'), 1, 0)) AS portals_equipment_edit_ssid_select_action,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__app_section IN('equipment', 'internet', 'tv','voice')) OR (visit__application_details__application_name = 'SpecNet'  AND message__name = 'selectAction' AND state__view__current_page__app_section IN('equipment', 'internet', 'tv','voice')) OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND state__view__current_page__app_section IN('equipment', 'internet', 'tv','voice')), 1, 0)) AS portals_equipment_feature_interaction,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND state__view__current_page__page_name IN ('my-internet-services', 'internetTab', 'internetUnsubscribed', 'my-voice-services', 'voiceTab', 'voiceUnsubscribed', 'my-tv-services', 'tvTab', 'tvUnsubscribed', 'services'), 1, 0)) AS portals_equipment_list_view,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'resetEquip' AND state__view__current_page__page_name IN('internetTab', 'tvTab', 'voiceTab')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name IN('internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name IN('internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot')), 1, 0)) AS portals_equipment_reset_flow_submit_all,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'footer-getSupport-accountSupport', 1, 0)) AS portals_footer_getsupport_acct_support,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'footer-getSupport-supportHome', 1, 0)) AS portals_footer_getsupport_support_home,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'login' AND state__view__current_page__elements__standardized_name = 'forgotPassword', 1, 0)) AS portals_forgot_password_flow_start,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__modal__name = 'newpasswordresponse-modal' AND state__view__current_page__page_name = 'newPasswordEntry') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'passwordRecoveryComplete'), 1, 0)) AS portals_forgot_password_success,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'login' AND state__view__current_page__elements__standardized_name = 'forgotUsername') OR (visit__application_details__application_name = 'SMB' AND message__name = 'pageView' AND state__view__current_page__page_name = 'recoveryEmailSent'), 1, 0)) AS portals_forgot_username_flow_start,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'loginRecoverySendEmail') OR (visit__application_details__application_name = 'SMB' AND message__name = 'pageView' AND state__view__current_page__page_name = 'recoveryEmailSent'), 1, 0)) AS portals_forgot_username_success,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'tourPointNext' AND message__context = 'onboardingTour', 1, 0)) AS portals_guided_tour_click_next,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('tourPointClose', 'tourPointDismiss') AND message__context = 'onboardingTour', 1, 0)) AS portals_guided_tour_exit,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND state__view__modal__name = 'tourPointModal', 1, 0)) AS portals_guided_tour_initiated_modal_view,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND state__view__modal__name = 'tourPointModal' AND message__feature__feature_step_name = '1 of 3', 1, 0)) AS portals_guided_tour_one_of_three,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'showMeLater' AND message__context = 'onboardingTour', 1, 0)) AS portals_guided_tour_show_me_later,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND state__view__modal__name = 'tourPointModal' AND message__feature__feature_step_name = '3 of 3', 1, 0)) AS portals_guided_tour_three_of_three,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND state__view__modal__name = 'tourPointModal' AND message__feature__feature_step_name = '2 of 3', 1, 0)) AS portals_guided_tour_two_of_three,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND state__view__current_page__page_name = 'accountHome' AND state__view__current_page__elements__standardized_name = 'wiFiProfile', 1, 0)) AS portals_install_wifi_profile_start,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND state__view__current_page__page_name = 'spectrumWiFiProfileResponse', 1, 0)) AS portals_install_wifi_profile_success,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_failure'  AND message__feature__feature_name = 'internetTroubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name = 'internetTroubleshoot' AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name = 'internetTroubleshoot' AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')), 1, 0)) AS portals_internet_equipment_reset_flow_failures,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'internetTab' AND state__view__current_page__elements__standardized_name = 'troubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__feature__feature_name = 'internetTroubleshoot') OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__feature__feature_name = 'internetTroubleshoot'), 1, 0)) AS portals_internet_equipment_reset_flow_starts,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'resetEquip' AND state__view__current_page__page_name = 'internetTab') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name = 'internetTroubleshoot') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name = 'internetTroubleshoot'), 1, 0)) AS portals_internet_equipment_reset_flow_submit,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_success' AND message__feature__feature_name = 'internetTroubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name = 'internetTroubleshoot' AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name = 'internetTroubleshoot' AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')), 1, 0)) AS portals_internet_equipment_reset_flow_successes,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__current_page__page_name = 'internetTab' AND state__view__modal__name = 'resetmodemfail-modal', 1, 0)) AS portals_internet_modem_reset_failures,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'internetTab' AND state__view__current_page__elements__standardized_name = 'troubleshoot', 1, 0)) AS portals_internet_modem_router_reset_starts,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__modal__name = 'resetrouterfail-modal' AND state__view__previous_page__page_name IN ('internetTab','equipmentHome') AND state__view__current_page__page_name <> 'voiceTab', 1, 0)) AS portals_internet_router_reset_failures,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'apiCall' AND state__view__current_page__page_name = 'resettingEquip' AND application__api__api_name = 'equipmentv1routerreset' AND state__view__previous_page__page_name IN ('equipmentHome','internetTab') AND ( application__api__response_code RLIKE '2.*' OR application__api__response_code = 429), 1, 0)) AS portals_internet_router_reset_successes,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support' AND state__view__current_page__page_url RLIKE '/support/internet*', 1, 0)) AS portals_internet_support_views,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('ask-spectrum','askSpectrumNextIT','askSpectrumASAPP', 'launchChat'), 1, 0)) AS portals_iva_opens,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'localNav-billing') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'navTabSelect' AND state__view__current_page__elements__ui_name = 'Billing'), 1, 0)) AS portals_localnav_billing,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'loginStart') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'loginStart') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'loginStart'), 1, 0)) AS portals_login_attempts,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'loginStop' AND operation__success = FALSE) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'loginStop' AND operation__success = FALSE) OR (visit__application_details__application_name = 'SMB' AND message__name = 'loginStop' AND operation__success = FALSE), 1, 0)) AS portals_login_failures,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'logout' AND operation__operation_type = 'logout', 1, 0)) AS portals_logout,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'featureStop' AND message__event_case_id = 'mySpectrum_featureStop_billing_autoPay_managementAbandon') OR (visit__application_details__application_name = 'SpecNet'  AND message__name = 'featureStop' AND message__event_case_id in ('SPECNET_billPay_billPayStop_autopayEnrollmentCancelled_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_manageAp_cancelSuccess')) OR (visit__application_details__application_name = 'SMB'  AND message__name = 'featureStop' AND message__event_case_id in ('SPECNET_billPay_billPayStop_autopayEnrollmentCancelled_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_manageAp_cancelSuccess')) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStop' AND message__event_case_id in ('SPECNET_billPay_billPayStop_autopayEnrollmentCancelled_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_manageAp_cancelSuccess')), 1, 0)) AS portals_manage_auto_payment_cancel,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStart' AND message__event_case_id = 'mySpectrum_featureStart_billing_autoPayManage') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__event_case_id in ('SPECNET_billPay_billPayStart_manageAutoPay', 'SPECTRUM_featureStart_billing_manageAutoPay')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__event_case_id in ('SPECNET_billPay_billPayStart_manageAutoPay', 'SPECTRUM_featureStart_billing_manageAutoPay')) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStart' AND message__event_case_id in ('SPECNET_billPay_billPayStart_manageAutoPay', 'SPECTRUM_featureStart_billing_manageAutoPay')), 1, 0)) AS portals_manage_auto_payment_starts,
        SUM(IF((visit__application_details__application_name = 'SpecMobile' AND message__name = 'featureStop' AND message__event_case_id = 'specMobile_feature_managePaymentMethodComplete' AND message__feature__feature_step_name = 'managePaymentMethodSuccess') OR (visit__application_details__application_name = 'SpecNet'  AND message__name = 'featureStop' AND message__event_case_id in ('SPECNET_billPay_billPayStop_autopayChangesConfirmation_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_manageApSuccess')) OR (visit__application_details__application_name = 'SMB'  AND message__name = 'featureStop' AND message__event_case_id in ('SPECNET_billPay_billPayStop_autopayChangesConfirmation_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_manageApSuccess')) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStop' AND message__event_case_id in ('SPECNET_billPay_billPayStop_autopayChangesConfirmation_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_manageApSuccess')), 1, 0)) AS portals_manage_auto_payment_successes,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'manualReset' AND state__view__current_page__elements__standardized_name = 'manualResetContinue', 1, 0)) AS portals_manual_reset_failures,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'manualReset', 1, 0)) AS portals_manual_reset_starts,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manualResetResolved', 1, 0)) AS portals_manual_reset_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'feedbackFormSend', 1, 0)) AS portals_msa_experience_feedback_click_submit_feedback,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'userFeedback' AND ((operation__user_entry__entry_type = 'feedbackForm') OR (operation__user_entry__entry_type = 'supportFeedbackForm' AND operation__user_entry__str_value = 'Yes')), 1, 0)) AS portals_msa_experience_feedback_goal_accomplished,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'userFeedback' AND ((operation__user_entry__entry_type = 'feedbackForm') OR (operation__user_entry__entry_type = 'supportFeedbackForm' AND operation__user_entry__str_value = 'No')), 1, 0)) AS portals_msa_experience_feedback_goal_not_accomplished,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'outageReportedBanner') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'page-level-alert-link-click' AND operation__operation_type = 'alertClick' AND message__event_case_id = 'SPECNET_selectAction_pageAlert'), 1, 0)) AS portals_one_time_alert_clicked,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'applicationActivity' AND operation__operation_type = 'serviceOutage') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'applicationActivity' AND operation__operation_type = 'alertView' AND message__event_case_id = 'SPECNET_pageAlertView'), 1, 0)) AS portals_one_time_page_alert_displayed,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentAmount' AND state__view__current_page__page_section__name = 'paymentAmount' AND message__event_case_id = 'SPECNET_selectAction_billing_payBillOnetimePaymentAmount') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentAmount' AND state__view__current_page__page_section__name = 'paymentAmount' AND message__event_case_id = 'SPECNET_selectAction_billing_payBillOnetimePaymentAmount'), 1, 0)) AS portals_one_time_payment_amount,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND ((state__view__current_page__elements__standardized_name = 'paymentMethodContinue'  AND operation__billing__payment_method = 'checkingAccount') OR (state__view__current_page__elements__standardized_name = 'payMethodContinue'  AND operation__billing__payment_method = 'checkingAccount') OR (state__view__current_page__elements__standardized_name = 'pay-bill.onetime.payment-method.checking'))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND ((state__view__current_page__elements__standardized_name = 'paymentMethodContinue'  AND operation__billing__payment_method = 'checkingAccount') OR (state__view__current_page__elements__standardized_name = 'payMethodContinue'  AND operation__billing__payment_method = 'checkingAccount') OR (state__view__current_page__elements__standardized_name = 'pay-bill.onetime.payment-method.checking'))), 1, 0)) AS portals_one_time_payment_checking,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview')) AND operation__billing__payment_method = 'checkingAccount') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview')) AND operation__billing__payment_method = 'checkingAccount'), 1, 0)) AS portals_one_time_payment_checking_account,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND (state__view__current_page__elements__standardized_name = 'paymentMethodContinue' AND operation__billing__payment_method = 'creditDebitCard') OR (state__view__current_page__elements__standardized_name = 'payMethodContinue'  AND operation__billing__payment_method = 'creditDebitCard')  OR (state__view__current_page__elements__standardized_name = 'pay-bill.onetime.payment-method.credit')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND (state__view__current_page__elements__standardized_name = 'paymentMethodContinue'  AND operation__billing__payment_method = 'creditDebitCard') OR (state__view__current_page__elements__standardized_name = 'payMethodContinue'  AND operation__billing__payment_method = 'creditDebitCard')  OR (state__view__current_page__elements__standardized_name = 'pay-bill.onetime.payment-method.credit')), 1, 0)) AS portals_one_time_payment_credit,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview')) AND operation__billing__payment_method = 'creditDebitCard') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview')) AND operation__billing__payment_method = 'creditDebitCard'), 1, 0)) AS portals_one_time_payment_credit_debit_card,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentDate' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_payBillOnetimePaymentDate') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentDate' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_payBillOnetimePaymentDate'), 1, 0)) AS portals_one_time_payment_date,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'otherDateContinue' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_otp_paymentDateOther_continue') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'otherDateContinue' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_otp_paymentDateOther_continue'), 1, 0)) AS portals_one_time_payment_date_other,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentDatePastDue' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_payBillOnetimePaymentDatePastDue') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentDatePastDue' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_payBillOnetimePaymentDatePastDue'), 1, 0)) AS portals_one_time_payment_date_past_due,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'todayContinue' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_otp_paymentDateToday_continue') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'todayContinue' AND state__view__current_page__page_section__name = 'paymentDate' AND message__event_case_id = 'SPECNET_selectAction_billing_otp_paymentDateToday_continue'), 1, 0)) AS portals_one_time_payment_date_today,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__event_case_id in ('mySpectrum_featureStop_billing_oneTimePaymentFailure', 'mySpectrum_featureStop_billing_oneTimePaymentWithAutoPayFailure')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStop' AND message__feature__feature_name in ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow') AND message__feature__feature_step_name in ('paymentFailure', 'otpFailure', 'otpApFailure', 'otpNoApFailure', 'otpPaperFailure', 'otpNoPaperFailure', 'completion') AND operation__success = FALSE) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStop' AND message__feature__feature_name in ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow') AND message__feature__feature_step_name in ('paymentFailure', 'otpFailure', 'otpApFailure', 'otpNoApFailure', 'otpPaperFailure', 'otpNoPaperFailure', 'completion') AND operation__success = FALSE) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStop' AND message__feature__feature_name in ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow') AND message__feature__feature_step_name in ('paymentFailure', 'otpFailure', 'otpApFailure', 'otpNoApFailure', 'otpPaperFailure', 'otpNoPaperFailure', 'completion') AND operation__success = FALSE), 1, 0)) AS portals_one_time_payment_failures,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND ((state__view__current_page__elements__standardized_name = 'paymentMethodContinue' AND operation__billing__payment_method = 'savingsAccount')) OR (state__view__current_page__elements__standardized_name = 'pay-bill.onetime.payment-method.savings') OR (state__view__current_page__elements__standardized_name = 'payMethodContinue' AND operation__billing__payment_method = 'savingsAccount')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND ((state__view__current_page__elements__standardized_name = 'paymentMethodContinue' AND operation__billing__payment_method = 'savingsAccount')) OR (state__view__current_page__elements__standardized_name = 'pay-bill.onetime.payment-method.savings') OR (state__view__current_page__elements__standardized_name = 'payMethodContinue' AND operation__billing__payment_method = 'savingsAccount')), 1, 0)) AS portals_one_time_payment_savings,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview')) AND operation__billing__payment_method = 'savingsAccount') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview')) AND operation__billing__payment_method = 'savingsAccount'), 1, 0)) AS portals_one_time_payment_savings_account,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('payAmountSelect', 'payAmountCurrent', 'payAmountDue', 'payAmountOther') AND state__view__current_page__page_name IN ('makePayment', 'paymentAmount')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-amount.statement.total', 'pay-bill.onetime.payment-amount.other', 'pay-bill.onetime.payment-amount.total', 'otherAmountContinue', 'statementTotalContinue', 'balanceTotalContinue')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-amount.statement.total', 'pay-bill.onetime.payment-amount.other', 'pay-bill.onetime.payment-amount.total', 'otherAmountContinue', 'statementTotalContinue', 'balanceTotalContinue')), 1, 0)) AS portals_one_time_payment_select_amount,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'paymentDateSelect' AND state__view__current_page__page_name = 'makePayment') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-date.past-due', 'pay-bill.onetime.payment-date.continue.other.date', 'pay-bill.onetime.payment-date.continue.today', 'todayContinue', 'otherDateContinue', 'pastDueDateContinue')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-date.past-due', 'pay-bill.onetime.payment-date.continue.other.date', 'pay-bill.onetime.payment-date.continue.today', 'todayContinue', 'otherDateContinue', 'pastDueDateContinue')), 1, 0)) AS portals_one_time_payment_select_date,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('paymentMethod', 'preselectedPayMethod', 'selectStoredPayMethod', 'newPayMethod') AND state__view__current_page__page_name IN('makePayment', 'paymentMethod')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-method.credit', 'pay-bill.onetime.payment-method.checking', 'pay-bill.onetime.payment-method.savings', 'paymentMethodContinue', 'payMethodContinue')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-method.credit', 'pay-bill.onetime.payment-method.checking', 'pay-bill.onetime.payment-method.savings', 'paymentMethodContinue', 'payMethodContinue')), 1, 0)) AS portals_one_time_payment_select_payment_method,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStart' AND message__event_case_id = 'mySpectrum_featureStart_billing_oneTimePayment') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__feature__feature_name IN ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__feature__feature_name IN ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow')) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStart' AND message__feature__feature_name IN ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow')), 1, 0)) AS portals_one_time_payment_starts,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND (array_contains(state__view__current_page__elements__selected_options, 'New Pay Method') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false,pmt:NewPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false,pmt:NewStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true,pmt:NewStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true,pmt:NewPayment'))) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newStoredPayment')))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newStoredPayment')))), 1, 0)) AS portals_one_time_payment_submission_new_payment_method,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newPayment')))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newPayment')))), 1, 0)) AS portals_one_time_payment_submission_new_payment_method_not_stored,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newStoredPayment')))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newStoredPayment')))), 1, 0)) AS portals_one_time_payment_submission_new_payment_method_stored,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND (array_contains(state__view__current_page__elements__selected_options, 'Stored Pay Method') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false,pmt:ExistingStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true,pmt:ExistingStoredPayment'))) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:savedPaymentMethod')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:savedPaymentMethod')))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('reviewCompleteMakePayment', 'makePaymentConfirm') AND ((array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:savedPaymentMethod')) OR (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:savedPaymentMethod')))), 1, 0)) AS portals_one_time_payment_submission_previously_stored_payment_method,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND message__event_case_id = 'mySpectrum_selectAction_makePaymentConfirm') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND message__event_case_id IN('SPECTRUM_selectAction_billing_reviewAndComplete_makePayment', 'SPECNET_selectAction_billing_otp_paymentReview_continue')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND message__event_case_id IN('SPECTRUM_selectAction_billing_reviewAndComplete_makePayment', 'SMB_selectAction_billing_otp_paymentReview_continue')), 1, 0)) AS portals_one_time_payment_submits,
        SUM(IF((((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview'))) AND (array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:savedPaymentMethod')))) OR (((visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview'))) AND (array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:savedPaymentMethod')))), 1, 0)) AS portals_one_time_payment_submits_with_ap,
        SUM(IF((((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview'))) AND (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:savedPaymentMethod')))) OR (((visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview'))) AND (array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:newStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:false, pmt:savedPaymentMethod')))), 1, 0)) AS portals_one_time_payment_submits_without_ap,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__event_case_id in ('mySpectrum_featureStop_billing_oneTimePaymentSuccess', 'mySpectrum_featureStop_billing_oneTimePaymentWithAutoPaySuccess')) OR (visit__application_details__application_name = 'SpecMobile' AND message__name = 'featureStop' AND message__event_case_id = 'specMobile_feature_oneTimePaymentComplete' AND message__category = 'billPay' AND message__feature__featuretype = 'billing' AND message__feature__feature_step_name = 'paymentSuccess') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStop' AND message__feature__feature_name in ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow') AND operation__success = TRUE) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStop' AND message__feature__feature_name in ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow') AND operation__success = TRUE) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStop' AND message__feature__feature_name in ('oneTimePayment', 'mobileLegacyFlow', 'mobileQuickPayFlow', 'coreLegacyFlow', 'coreQuickPayFlow') AND operation__success = TRUE), 1, 0)) AS portals_one_time_payment_successes,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND ((state__view__current_page__page_name IN ('paymentWithAutoPaySuccess', 'paySuccessAutoPay') AND  state__view__previous_page__page_name ='makePayment') OR (state__view__current_page__page_name IN ('paymentSuccess', 'paymentWithAutoPaySuccess', 'paySuccessAutoPay') AND  state__view__previous_page__page_name IN ('makePayment', 'reviewCompletePayment') AND  state__view__current_page__enc_page_title ='LgsxBZZVnUk3mp3m26ohd2KZfG3K+TR93WFsmAsPsuc='))) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStop' AND message__event_case_id IN ('SPECNET_selectAction_billPayStop_otpAp_triggeredByApplicationSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStop' AND message__event_case_id IN('SMB_featureStop_billPayStop_otpSuccess_autoPay', 'SPECNET_selectAction_billPayStop_otpAp_triggeredByApplicationSuccess')), 1, 0)) AS portals_one_time_payment_successes_with_ap_enroll,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND ((state__view__current_page__page_name IN ('paymentSuccess', 'paySuccess') AND state__view__previous_page__page_name ='makePayment') OR (state__view__current_page__page_name IN ('paymentSuccess', 'paySuccess') AND  state__view__previous_page__page_name IN ('makePayment', 'reviewCompletePayment') AND  state__view__current_page__enc_page_title IN('XEXeb2huYukECBCEhwakhg==', 'd8Iu1kR+VoahV0z9YYFAbKKdQTeqexrJbX53AKytRQY=', 'S8EmpRJEvi5AxPl/zDlXBqMIFANkI2sqxIhVUyvdzsZEqHZ6FW5xGU2qXM0oDGN5')))) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStop' AND message__event_case_id IN ('SPECNET_selectAction_billPayStop_otp_triggeredByApplicationSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStop' AND message__event_case_id IN('SMB_featureStop_billPayStop_otpSuccess', 'SPECNET_selectAction_billPayStop_otp_triggeredByApplicationSuccess')), 1, 0)) AS portals_one_time_payment_successes_without_ap_enroll,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'pageView'), 1, 0)) AS portals_page_views,
        SUM(IF((visit__application_details__application_name = 'SpecNet'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_settings_notifications_billDelivery_save' AND operation__settings_updates['enrollmentChange'] = 'true' AND operation__settings_updates['deliveryMethod'] = 'paperless') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_settings_notifications_billDelivery_save' AND operation__settings_updates['enrollmentChange'] = 'true' AND operation__settings_updates['deliveryMethod'] = 'paperless'), 1, 0)) AS portals_paperless_radio_toggle,
        SUM(IF((visit__application_details__application_name = 'SpecNet'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_paperlessBillingToggle') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND message__event_case_id = 'SPECTRUM_selectAction_paperlessBillingToggle'), 1, 0)) AS portals_paperless_toggle,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'appointmentReschedule') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'appointmentReschedule'), 1, 0)) AS portals_rescheduled_service_appointment_start,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'reschedApptConfirm') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'assetDisplayed' AND message__event_case_id IN( 'SPECTRUM_assetDisplayed_appointments_rescheduleApptSuccess',  'SPECTRUM_serviceAppt_unauthRescheduleApptSuccess', 'SPECNET_assetDisplayed_serviceAppt_authRescheduleApptSuccess')) OR (visit__application_details__application_name = 'SMB'  AND message__name = 'assetDisplayed' AND message__event_case_id IN( 'SPECTRUM_assetDisplayed_appointments_rescheduleApptSuccess',  'SPECTRUM_serviceAppt_unauthRescheduleApptSuccess', 'SPECNET_assetDisplayed_serviceAppt_authRescheduleApptSuccess')), 1, 0)) AS portals_rescheduled_service_appointments,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'portForwardAndIpResInfo', 1, 0)) AS portals_router_advanced_settings_click_about_port_forward,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'addPortAssignment', 1, 0)) AS portals_router_advanced_settings_click_add_port_assignment,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'cancelDnsChanges', 1, 0)) AS portals_router_advanced_settings_click_cancel_dns_change,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'cancelPortAssignmentDetailsEntry', 1, 0)) AS portals_router_advanced_settings_click_cancel_port_assignment,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'createIPReservationDevice', 1, 0)) AS portals_router_advanced_settings_click_create_ip_reservation,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('confirmDeletePortAssignment', 'cancelDeletePortAssignment'), 1, 0)) AS portals_router_advanced_settings_click_delete_or_cancel_delete_port,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'deletePortAssignment', 1, 0)) AS portals_router_advanced_settings_click_delete_port,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'dnsServer', 1, 0)) AS portals_router_advanced_settings_click_dns,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageDns', 1, 0)) AS portals_router_advanced_settings_click_manage_dns,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'existingIPReservationsDevice', 1, 0)) AS portals_router_advanced_settings_click_manage_ip_reservations,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'portForwardAndIpRes', 1, 0)) AS portals_router_advanced_settings_click_port_forward,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'resetToDefault', 1, 0)) AS portals_router_advanced_settings_click_reset_dns_default,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'confirmDnsChanges', 1, 0)) AS portals_router_advanced_settings_click_save_confirm_dns,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'confirmResetDnsDefault', 1, 0)) AS portals_router_advanced_settings_click_spectrum_dns_default,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'universalPlugAndPlay', 1, 0)) AS portals_router_advanced_settings_click_upnp,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'selectExistingPortAssignment', 1, 0)) AS portals_router_advanced_settings_click_use_existing_port,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'deletePortAssignment' AND operation__operation_type = 'swipe', 1, 0)) AS portals_router_advanced_settings_delete_port_assignment_via_swipe,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__modal__name = 'okPortUnavailable', 1, 0)) AS portals_router_advanced_settings_port_unavailable_modal,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'reserveIPToggle' AND operation__toggle_state = FALSE, 1, 0)) AS portals_router_advanced_settings_reserve_ip_toggle_off,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'reserveIPToggle' AND operation__toggle_state = TRUE, 1, 0)) AS portals_router_advanced_settings_reserve_ip_toggle_on,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'UPnPToggle' AND operation__toggle_state = FALSE, 1, 0)) AS portals_router_advanced_settings_upnp_toggle_off,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'UPnPToggle' AND operation__toggle_state = TRUE, 1, 0)) AS portals_router_advanced_settings_upnp_toggle_on,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'saveDeviceNickname', 1, 0)) AS portals_save_edit_device_nickname,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'pauseDeviceCancel' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_click_cancel_pause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'unpauseDeviceCancel' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_click_cancel_unpause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'internetNotConnectedDevices' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_click_not_connected_devices_tab,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'pauseDevice' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_click_pause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'internetPausedDevices' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_click_paused_tab,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'unpauseDevice' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_click_unpause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Create Pod Name:false', 1, 0)) AS portals_scp_final_confirm_create_pod_name_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Create Pod Name:true', 1, 0)) AS portals_scp_final_confirm_create_pod_name_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Device Nickname Change:false', 1, 0)) AS portals_scp_final_confirm_device_nickname_change_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Device Nickname Change:true', 1, 0)) AS portals_scp_final_confirm_device_nickname_change_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Device Type & Nickname Change:false', 1, 0)) AS portals_scp_final_confirm_device_type_and_nickname_change_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Device Type & Nickname Change:true', 1, 0)) AS portals_scp_final_confirm_device_type_and_nickname_change_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Device Type Change:false', 1, 0)) AS portals_scp_final_confirm_device_type_icon_update_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Device Type Change:true', 1, 0)) AS portals_scp_final_confirm_device_type_icon_update_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Edit Pod Name:false', 1, 0)) AS portals_scp_final_confirm_edit_pod_name_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Edit Pod Name: true', 1, 0)) AS portals_scp_final_confirm_edit_pod_name_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Manual Pause Device:false', 1, 0)) AS portals_scp_final_confirm_pause_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Manual Pause Device:true', 1, 0)) AS portals_scp_final_confirm_pause_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW: Refresh Pod: false', 1, 0)) AS portals_scp_final_confirm_refresh_pod_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Refresh Pod:true', 1, 0)) AS portals_scp_final_confirm_refresh_pod_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Remove Device:false', 1, 0)) AS portals_scp_final_confirm_remove_device_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Remove Device:true', 1, 0)) AS portals_scp_final_confirm_remove_device_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Manual Unpause Device:false', 1, 0)) AS portals_scp_final_confirm_unpause_failure,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value = 'AIHW:Manual Unpause Device:true', 1, 0)) AS portals_scp_final_confirm_unpause_success,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND message__event_case_id = 'mySpectrum_pageView_multiAP_listOfPods', 1, 0)) AS portals_scp_list_of_pods_pv,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'pageView' AND message__event_case_id = 'mySpectrum_pageView_multiAP_podDetails', 1, 0)) AS portals_scp_pod_details_pv,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'cancelRemoveDevice' AND operation__operation_type = 'buttonClick', 1, 0)) AS portals_scp_remove_device_cancel,
        SUM(IF(visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND message__event_case_id = 'mySpectrum_selectAction_selectPod', 1, 0)) AS portals_scp_select_pod_from_list,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'apiCall' AND ((message__event_case_id IN('SPECTRUM_Campaigns_API_Success', 'SPECTRUM_Campaigns_API_Failure')AND application__api__response_text RLIKE '.*SECURITY_QUESTION_AND_ANSWER.*') OR (message__event_case_id IN('SPECNET_Generic_API_Call_Success', 'SPECNET_Generic_API_Call_Failure') AND application__api__response_text RLIKE '.*SECURITY_QUESTION_AND_ANSWER.*'))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'apiCall' AND ((message__event_case_id IN('SPECTRUM_Campaigns_API_Success', 'SPECTRUM_Campaigns_API_Failure')AND application__api__response_text RLIKE '.*SECURITY_QUESTION_AND_ANSWER.*') OR (message__event_case_id IN('SPECNET_Generic_API_Call_Success', 'SPECNET_Generic_API_Call_Failure') AND application__api__response_text RLIKE '.*SECURITY_QUESTION_AND_ANSWER.*'))), 1, 0)) AS portals_security_qa_campaign_interaction,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__page_name = 'campaignSecurity') OR (visit__application_details__application_name = 'SMB' AND message__name = 'pageView' AND state__view__current_page__page_name = 'campaignSecurity'), 1, 0)) AS portals_security_qa_update_security_page_view,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'selectAction'), 1, 0)) AS portals_select_actions,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id IN('mySpectrum_featureStop_billing_autoPay_enrollmentWithPaymentFailure', 'mySpectrum_featureStop_billing_autoPay_enrollmentFailure')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStop' AND message__feature__feature_name IN ('autoPayEnrollment') AND operation__success = FALSE AND message__event_case_id NOT RLIKE '.*Cancelled.*') OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStop' AND message__feature__feature_name IN ('autoPayEnrollment') AND operation__success = FALSE AND message__event_case_id NOT RLIKE '.*Cancelled.*') OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStop' AND message__feature__feature_name IN ('autoPayEnrollment') AND operation__success = FALSE AND message__event_case_id NOT RLIKE '.*Cancelled.*'), 1, 0)) AS portals_set_up_auto_payment_failures,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStart' AND message__event_case_id = 'mySpectrum_featureStart_billing_autoPayEnroll') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__event_case_id in ('SPECNET_billPay_billPayStart_autoPayEnroll', 'SPECTRUM_featureStart_billing_apEnrollment')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__event_case_id in ('SPECNET_billPay_billPayStart_autoPayEnroll', 'SPECTRUM_featureStart_billing_apEnrollment')) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStart' AND message__event_case_id in ('SPECNET_billPay_billPayStart_autoPayEnroll', 'SPECTRUM_featureStart_billing_apEnrollment')), 1, 0)) AS portals_set_up_auto_payment_starts,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND message__event_case_id IN('SPECNET_selectAction_billing_enrollAutopay_alreadyPaidBalanceDue', 'SPECNET_selectAction_billing_enrollAutopay_noBalance', 'SPECNET_selectAction_billing_enrollAutopay_withBalance')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND message__event_case_id IN('SPECNET_selectAction_billing_enrollAutopay_alreadyPaidBalanceDue', 'SPECNET_selectAction_billing_enrollAutopay_noBalance', 'SPECNET_selectAction_billing_enrollAutopay_withBalance')), 1, 0)) AS portals_set_up_auto_payment_submits,
        SUM(IF(((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.enroll-in-autopay-no-balance-checkingAccount', 'pay-bill.enroll-in-autopay-no-balance-savingsAccount', 'pay-bill.enroll-in-autopay-no-balance-creditDebitCard', 'pay-bill.enroll-in-autopay-with-balance-creditDebitCard', 'pay-bill.enroll-in-autopay-with-balance-checkingAccount', 'pay-bill.enroll-in-autopay-with-balance-savingsAccount', 'pay-bill.enroll-in-autopay.already-paid-balance-due', 'balanceDuePaid') AND state__view__current_page__page_section__name = 'enroll-in-autopay') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('enrollNoBalanceChecking', 'enrollNoBalanceSavings', 'enrollNoBalanceCreditDebitCard', 'enrollWithBalanceCreditDebitCard', 'enrollWithBalanceChecking', 'enrollWithBalanceSavings') AND state__view__current_page__page_section__name = 'autoPayEnrollment') OR ((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview'))) AND (array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:savedPaymentMethod')))) OR ((visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('pay-bill.enroll-in-autopay-no-balance-checkingAccount', 'pay-bill.enroll-in-autopay-no-balance-savingsAccount', 'pay-bill.enroll-in-autopay-no-balance-creditDebitCard', 'pay-bill.enroll-in-autopay-with-balance-creditDebitCard', 'pay-bill.enroll-in-autopay-with-balance-checkingAccount', 'pay-bill.enroll-in-autopay-with-balance-savingsAccount', 'pay-bill.enroll-in-autopay.already-paid-balance-due', 'balanceDuePaid') AND state__view__current_page__page_section__name = 'enroll-in-autopay') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN ('enrollNoBalanceChecking', 'enrollNoBalanceSavings', 'enrollNoBalanceCreditDebitCard', 'enrollWithBalanceCreditDebitCard', 'enrollWithBalanceChecking', 'enrollWithBalanceSavings') AND state__view__current_page__page_section__name = 'autoPayEnrollment') OR ((visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__app_section = 'billing' AND ((state__view__current_page__elements__standardized_name IN ('pay-bill.onetime.payment-review.make-payment', 'reviewCompleteMakePayment') AND state__view__current_page__page_section__name = 'make-a-payment') OR (state__view__current_page__elements__standardized_name = 'makePaymentConfirm' AND state__view__current_page__page_section__name = 'paymentReview'))) AND (array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:newStoredPayment') OR array_contains(state__view__current_page__elements__selected_options, 'autopay:true, pmt:savedPaymentMethod')))), 1, 0)) AS portals_set_up_auto_payment_submits_plus_otp,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id IN( 'mySpectrum_featureStop_billing_autoPay_enrollmentWithPaymentSuccess', 'mySpectrum_featureStop_billing_autoPay_enrollmentSuccess')) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStop' AND message__event_case_id IN('SPECNET_billPay_billPayStop_autopayEnrolled_triggeredByApplicationSuccess', 'SPECNET_billPay_billPayStop_autopayEnrollmentWithPayment_triggeredByApplicationSuccess', 'SPECTRUM_featureStop_billing_apEnrollmentSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStop' AND message__event_case_id IN('SPECNET_billPay_billPayStop_autopayEnrolled_triggeredByApplicationSuccess', 'SPECNET_billPay_billPayStop_autopayEnrollmentWithPayment_triggeredByApplicationSuccess', 'SMB_featureStop_billPayStop_apEnrollSuccess_withPayment', 'SMB_featureStop_billPayStop_apEnrollSuccess', 'SPECTRUM_featureStop_billing_apEnrollmentSuccess')) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'featureStop' AND message__event_case_id IN('SPECNET_billPay_billPayStop_autopayEnrolled_triggeredByApplicationSuccess', 'SPECNET_billPay_billPayStop_autopayEnrollmentWithPayment_triggeredByApplicationSuccess','SMB_featureStop_billPayStop_apEnrollSuccess_withPayment', 'SMB_featureStop_billPayStop_apEnrollSuccess', 'SPECTRUM_featureStop_billing_apEnrollmentSuccess')), 1, 0)) AS portals_set_up_auto_payment_successes,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id = 'mySpectrum_featureStop_billing_autoPay_enrollmentWithPaymentSuccess') OR (visit__application_details__application_name = 'SpecNet' AND (message__event_case_id IN ('SPECNET_billPay_billPayStop_autopayEnrollmentWithPayment_triggeredByApplicationSuccess'))) OR (visit__application_details__application_name = 'SMB' AND ((message__name = 'featureStop' AND message__feature__feature_step_name IN( 'apEnrollSuccessWithPayment') AND message__feature__feature_step_changed = TRUE) OR ((message__event_case_id IN ('SPECNET_billPay_billPayStop_autopayEnrollmentWithPayment_triggeredByApplicationSuccess'))))), 1, 0)) AS portals_set_up_auto_payment_successes_with_payment,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id IN ('mySpectrum_featureStop_billing_autoPay_enrollmentSuccess')) OR (visit__application_details__application_name = 'SpecNet' AND (message__event_case_id IN ('SPECNET_billPay_billPayStop_autopayEnrolled_triggeredByApplicationSuccess'))) OR (visit__application_details__application_name = 'SMB' AND ((message__name = 'featureStop' AND message__feature__feature_step_name IN( 'apEnrollSuccess') AND message__feature__feature_step_changed = TRUE) OR ((message__event_case_id IN ('SPECNET_billPay_billPayStop_autopayEnrolled_triggeredByApplicationSuccess'))))), 1, 0)) AS portals_set_up_auto_payment_successes_without_payment,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageSignInSecurityInfo') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageSignInSecurityInfo'), 1, 0)) AS portals_settings_sign_in_security_manage_select_action,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'subNavPeople' AND state__view__current_page__page_section__name = 'subNav') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'subNavPeople' AND state__view__current_page__page_section__name = 'subNav'), 1, 0)) AS portals_settings_sign_in_security_subnav_people_select_action,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'verify') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'verify'), 1, 0)) AS portals_settings_verify_select_action,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'applicationActivity' AND state__view__current_page__page_name = 'contactInfo' AND operation__operation_type = 'spinnerSuccess') OR (visit__application_details__application_name = 'SMB' AND message__name = 'applicationActivity' AND state__view__current_page__page_name = 'contactInfo' AND operation__operation_type = 'spinnerSuccess'), 1, 0)) AS portals_settings_your_info_changes_success,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageContact' AND state__view__current_page__page_section__name = 'contactInfo') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'manageContact' AND state__view__current_page__page_section__name = 'contactInfo'), 1, 0)) AS portals_settings_your_info_manage_select_action,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'saveContactInfo') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'saveContactInfo'), 1, 0)) AS portals_settings_your_info_save_select_action,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND state__view__modal__name = 'verifyIdentity' AND state__view__modal__modal_type = 'message') OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND state__view__modal__name = 'verifyIdentity' AND state__view__modal__modal_type = 'message'), 1, 0)) AS portals_settings_your_info_verify_identity_modal_view,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'applicationActivity' AND operation__operation_type = 'spinnerSuccess') OR (visit__application_details__application_name = 'SMB' AND message__name = 'applicationActivity' AND operation__operation_type = 'spinnerSuccess'), 1, 0)) AS portals_settings_your_info_verify_success,
        SUM(IF((visit__application_details__application_name = 'MySpectrum') OR (visit__application_details__application_name = 'SpecMobile') OR (visit__application_details__application_name = 'SpecNet') OR (visit__application_details__application_name = 'SMB') OR (visit__application_details__application_name = 'SpectrumCommunitySolutions'), 1, 0)) AS portals_site_unique,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'loginStop' AND operation__success = TRUE) OR (visit__application_details__application_name = 'SpecMobile' AND message__name = 'loginStop' AND message__event_case_id = 'specMobile_login_manualSuccess' AND operation__operation_type in ('manualAuth', 'biometricAuth') AND operation__success = True) OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'userConfigSet' AND visit__account__enc_account_number IS NOT NULL) OR (visit__application_details__application_name = 'SMB' AND message__name = 'userConfigSet' AND visit__account__enc_account_number IS NOT NULL) OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'userConfigSet' AND visit__account__enc_account_number IS NOT NULL), 1, 0)) AS portals_site_unique_auth,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND visit__device__operating_system RLIKE '.*iOS|Android.*') OR (visit__application_details__application_name = 'SMB'  AND visit__device__operating_system RLIKE '.*iOS|Android.*'), 1, 0)) AS portals_site_unique_mobile,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND visit__device__operating_system NOT RLIKE '.*iOS|Android.*') OR (visit__application_details__application_name = 'SMB'  AND visit__device__operating_system NOT RLIKE '.*iOS|Android.*'), 1, 0)) AS portals_site_unique_pc,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'pauseDeviceConfirm', 1, 0)) AS portals_start_pause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'unpauseDeviceConfirm', 1, 0)) AS portals_start_unpause_device,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'supportArticleSelect', 1, 0)) AS portals_support_article_select,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'supportHome', 1, 0)) AS portals_support_button,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support') OR (visit__application_details__application_name = 'SpecMobile' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support') OR (visit__application_details__application_name = 'SMB' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support') OR (visit__application_details__application_name = 'SpectrumCommunitySolutions' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support'), 1, 0)) AS portals_support_page_views,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'assetDisplayed' AND message__event_case_id = 'SPECTRUM_appointments_appointmentsDetails' AND state__view__current_page__page_section__name = 'authenticatedAppointments') OR (visit__application_details__application_name = 'SMB' AND message__name IN('pageView','assetDisplayed') AND (message__event_case_id = 'SMB_pageView_appointments' OR (message__event_case_id =  'SPECTRUM_appointments_appointmentsDetails' AND state__view__current_page__page_section__name = 'authenticatedAppointments') )), 1, 0)) AS portals_tech_tracker_auth_views,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__page_name = 'unauthenticatedServiceAppts') OR (visit__application_details__application_name = 'SMB' AND message__name = 'pageView' AND state__view__current_page__page_name = 'unauthenticatedServiceAppts'), 1, 0)) AS portals_tech_tracker_unauth_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'onboardingTour' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNskI+lFfepycO4vaK1f1sy8A=', 1, 0)) AS portals_tutorial_account_page_five_page_view,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'onboardingTour' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsn0zva/63sH82ZGlz6S7/4g=', 1, 0)) AS portals_tutorial_account_page_four_page_view,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'onboardingTour' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsthZZPBZmVsOnuyHE/xnHLI=', 1, 0)) AS portals_tutorial_equip_page_three_page_view,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'onboardingTour' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsmctMWQ76QOVQ+A9I4OwOL4=', 1, 0)) AS portals_tutorial_otp_page_two_page_view,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'onboardingTour' AND state__view__current_page__enc_page_title = 'xkSMVLApIgOL+WLpKYHNsj4CkjWNvrJkbJOw2hClPdI=', 1, 0)) AS portals_tutorial_start_page_one_page_view,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'onboardingTour', 1, 0)) AS portals_tutorial_views,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_failure'  AND message__feature__feature_name = 'tvTroubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name = 'tvTroubleshoot' AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name = 'tvTroubleshoot' AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')), 1, 0)) AS portals_tv_equipment_reset_flow_failures,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'tvTab' AND state__view__current_page__elements__standardized_name = 'troubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__feature__feature_name = 'tvTroubleshoot') OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__feature__feature_name = 'tvTroubleshoot'), 1, 0)) AS portals_tv_equipment_reset_flow_starts,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'resetEquip' AND state__view__current_page__page_name = 'tvTab') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name = 'tvTroubleshoot') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name = 'tvTroubleshoot'), 1, 0)) AS portals_tv_equipment_reset_flow_submit,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_success' AND message__feature__feature_name = 'tvTroubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name = 'tvTroubleshoot' AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name = 'tvTroubleshoot' AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')), 1, 0)) AS portals_tv_equipment_reset_flow_successes,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__current_page__page_name = 'tvTab' AND state__view__modal__name = 'resetmodemfail-modal', 1, 0)) AS portals_tv_modem_reset_failures,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__current_page__page_name = 'tvTab' AND state__view__modal__name = 'resetrouterfail-modal', 1, 0)) AS portals_tv_router_reset_failures,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__page_name = 'home-unauth') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'pageView' AND state__view__current_page__page_name = 'homeUnauth'), 1, 0)) AS portals_unauth_homepage_page_views,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'apiCall' AND ((message__event_case_id IN('SPECTRUM_Campaigns_API_Success', 'SPECTRUM_Campaigns_API_Failure') AND (application__api__response_text RLIKE '.*NAME_INVALID_IDENTITY_CONTACT.*' OR application__api__response_text RLIKE '.*NAME_MISSING_IDENTITY_CONTACT.*' OR application__api__response_text RLIKE '.*NAME_ANNUAL_IDENTITY_CONTACT.*' )) OR (message__event_case_id IN('SPECNET_Generic_API_Call_Success', 'SPECNET_Generic_API_Call_Failure') AND application__api__response_text RLIKE '.*NAME_MISSING_IDENTITY_CONTACT.*'))) OR (visit__application_details__application_name = 'SMB' AND message__name = 'apiCall' AND ((message__event_case_id IN('SPECTRUM_Campaigns_API_Success', 'SPECTRUM_Campaigns_API_Failure') AND (application__api__response_text RLIKE '.*NAME_INVALID_IDENTITY_CONTACT.*' OR application__api__response_text RLIKE '.*NAME_MISSING_IDENTITY_CONTACT.*' OR application__api__response_text RLIKE '.*NAME_ANNUAL_IDENTITY_CONTACT.*' )) OR (message__event_case_id IN('SPECNET_Generic_API_Call_Success', 'SPECNET_Generic_API_Call_Failure') AND application__api__response_text RLIKE '.*NAME_MISSING_IDENTITY_CONTACT.*'))), 1, 0)) AS portals_update_missing_contact_campaign_interaction,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'cancelCampaign' AND state__view__current_page__page_name = 'campaignContact') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'cancelCampaign' AND state__view__current_page__page_name = 'campaignContact'), 1, 0)) AS portals_update_missing_contact_cancel_close_window,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('saveCampaign') AND state__view__current_page__page_name = 'campaignContact') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('saveCampaign') AND state__view__current_page__page_name = 'campaignContact'), 1, 0)) AS portals_update_missing_contact_save,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('saveCampaign', 'saveAndContinueCampaign') AND state__view__current_page__page_name = 'campaignContact') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('saveCampaign', 'saveAndContinueCampaign') AND state__view__current_page__page_name = 'campaignContact'), 1, 0)) AS portals_update_missing_contact_save_all,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('saveAndContinueCampaign') AND state__view__current_page__page_name = 'campaignContact') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN('saveAndContinueCampaign') AND state__view__current_page__page_name = 'campaignContact'), 1, 0)) AS portals_update_missing_contact_save_and_continue,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'skipThisCampaign' AND state__view__current_page__page_name = 'campaignContact') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'skipThisCampaign' AND state__view__current_page__page_name = 'campaignContact'), 1, 0)) AS portals_update_missing_contact_skip_this,
        SUM(IF((visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'updateCampaign' AND state__view__current_page__elements__ui_name = 'Update All') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'updateCampaign' AND state__view__current_page__elements__ui_name = 'Update All'), 1, 0)) AS portals_update_missing_contact_update_all,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'home-authenticated' AND state__view__current_page__elements__standardized_name = 'Upgrade-Overview-Banner', 1, 0)) AS portals_upgrade_links_overview,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equipment.internet.upgrade-service', 1, 0)) AS portals_upgrade_service_internet,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support' AND state__view__current_page__page_url RLIKE '/support/tv*', 1, 0)) AS portals_video_support_views,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'internetConnectedDevices', 1, 0)) AS portals_view_connected_devices,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'statementDetail') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN( 'downloadStatement', 'pay-bill.billing-statement-download')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name IN( 'downloadStatement', 'pay-bill.billing-statement-download')), 1, 0)) AS portals_view_online_statments,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'voicemailDelete') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'deleteMessage'), 1, 0)) AS portals_voice_delete_messages,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_failure' AND message__feature__feature_name = 'voiceTroubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name = 'voiceTroubleshoot' AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name = 'voiceTroubleshoot' AND message__feature__feature_step_name IN( 'resetFailureModal', 'resetFailure') AND state__view__modal__name IN( 'Reset-Equipment-Failure', 'equipmentResetFailure')), 1, 0)) AS portals_voice_equipment_reset_flow_failures,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__page_name = 'voiceTab' AND state__view__current_page__elements__standardized_name = 'troubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'featureStart' AND message__feature__feature_name = 'voiceTroubleshoot') OR (visit__application_details__application_name = 'SMB' AND message__name = 'featureStart' AND message__feature__feature_name = 'voiceTroubleshoot'), 1, 0)) AS portals_voice_equipment_reset_flow_starts,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'resetEquip' AND state__view__current_page__page_name = 'voiceTab') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name = 'voiceTroubleshoot') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'equip.troubleshoot.reset-equip.start' AND message__feature__feature_step_name = 'startReset' AND message__feature__feature_name = 'voiceTroubleshoot'), 1, 0)) AS portals_voice_equipment_reset_flow_submit,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'featureStop' AND message__event_case_id = 'mySpectrum_featureStop_equipment_troubleshootFlowStop_success' AND message__feature__feature_name = 'tvTroubleshoot') OR (visit__application_details__application_name = 'SpecNet' AND message__name = 'modalView' AND message__feature__feature_name = 'voiceTroubleshoot' AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')) OR (visit__application_details__application_name = 'SMB' AND message__name = 'modalView' AND message__feature__feature_name = 'voiceTroubleshoot' AND message__feature__feature_step_name IN( 'resetSuccessModal', 'resetSuccess') AND state__view__modal__name IN( 'Reset-Equipment-Success', 'equipmentResetSuccess')), 1, 0)) AS portals_voice_equipment_reset_flow_successes,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__current_page__page_name = 'voiceTab' AND state__view__modal__name = 'resetmodemfail-modal', 1, 0)) AS portals_voice_modem_reset_failures,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'pageView' AND state__view__current_page__page_name = 'voicemailHome') OR (visit__application_details__application_name = 'SMB' AND state__view__current_page__app_section = 'voice' AND message__name = 'pageView'), 1, 0)) AS portals_voice_pageviews,
        SUM(IF((visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'voicemailPlay') OR (visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'playMessage'), 1, 0)) AS portals_voice_play_messages,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'modalView' AND state__view__current_page__page_name = 'voiceTab' AND state__view__modal__name = 'resetrouterfail-modal', 1, 0)) AS portals_voice_router_reset_failures,
        SUM(IF(visit__application_details__application_name = 'SpecNet' AND message__name = 'pageView' AND state__view__current_page__app_section = 'support' AND state__view__current_page__page_url RLIKE '/support/voice*', 1, 0)) AS portals_voice_support_views,
        SUM(IF(visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'voiceSettingsForwardingSave', 1, 0)) AS portals_voice_update_call_forward_settings,
        SUM(IF(visit__application_details__application_name = 'SMB' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'toggleMessages', 1, 0)) AS portals_voice_view_messages,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'viewVoicemail', 1, 0)) AS portals_voice_voicemail_view_select_action,
        SUM(IF(visit__application_details__application_name = 'MySpectrum' AND message__name = 'selectAction' AND state__view__current_page__elements__standardized_name = 'internetShowPassword', 1, 0)) AS portals_wifi_password_views,
        SUM(IF((visit__application_details__application_name = 'MySpectrum'  AND message__name = 'applicationActivity' AND message__event_case_id = 'mySpectrum_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value RLIKE '.*WPA2 Password Change(: |:)true.*') OR (visit__application_details__application_name = 'SpecNet'  AND message__name = 'applicationActivity' AND message__event_case_id = 'SPECTRUM_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value RLIKE '.*WPA2 Password Change(: |:)true.*') OR (visit__application_details__application_name = 'SMB'  AND message__name = 'applicationActivity' AND message__event_case_id = 'SPECTRUM_applicationActivity_generic_finalConfirm' AND state__view__current_page__elements__element_string_value RLIKE '.*WPA2 Password Change(: |:)true.*'), 1, 0)) AS portals_wifi_pw_changes,
visit__account__enc_account_number as portals_unique_acct_key,
visit__activated_experiments as activated_experiments,
visit__application_details__technology_type as technology_type,
cast(NULL as INT) as calls_within_24_hrs,
epoch_converter(received__timestamp, 'America/Denver') AS denver_date
FROM

(SELECT application__api__api_name,
      application__api__path,
      application__api__response_code,
      application__api__response_text,
      application__api__service_result,
      application__error__error_code,
      application__error__error_message,
      application__error__error_type,
      message__category,
      message__context,
      message__event_case_id,
      message__feature__feature_name,
      message__feature__featuretype,
      message__feature__feature_step_changed,
      message__feature__feature_step_name,
      message__name,
      operation__billing__payment_amount_usd,
      operation__billing__payment_date,
      operation__billing__payment_due_date,
      operation__billing__payment_method,
      operation__operation_type,
      operation__success,
      operation__toggle_state,
      operation__settings_updates,
      operation__user_entry__enc_feedback,
      operation__user_entry__entry_type,
      operation__user_entry__numeric,
      operation__user_entry__str_value,
      received__timestamp,
      state__content__content_class,
      state__content__details__episode_number,
      state__content__details__genres,
      state__content__details__season_number,
      state__content__identifiers__tms_program_id,
      state__content__programmer__linear__channel_name,
      state__content__stream__playback_id,
      state__content__stream__playback_type,
      state__view__current_page__app_section,
      state__view__current_page__current_balance_amount,
      state__view__current_page__elements__element_int_value,
      state__view__current_page__elements__element_string_value,
      state__view__current_page__elements__selected_options,
      state__view__current_page__elements__standardized_name,
      state__view__current_page__elements__ui_name,
      state__view__current_page__page_name,
      state__view__current_page__page_section__name,
      state__view__current_page__page_sub_section__name,
      state__view__current_page__page_title,
      state__view__current_page__enc_page_title,
      state__view__current_page__page_url,
      state__view__current_page__past_due_amount,
      state__view__current_page__total_amount_due,
      state__view__modal__modal_type,
      state__view__modal__name,
      state__view__modal__text,
      state__view__previous_page__app_section,
      state__view__previous_page__page_name,
      visit__account__details__auto_pay_status,
      visit__account__details__billing_status,
      visit__account__details__mso,
      visit__account__enc_account_billing_division,
      visit__account__enc_account_billing_division_id,
      visit__account__enc_account_billing_id,
      visit__account__enc_account_number,
      visit__activated_experiments,
      visit__application_details__app_version,
      visit__application_details__application_name,
      visit__application_details__application_type,
      visit__application_details__technology_type,
      visit__connection__connection_type,
      visit__connection__network_status,
      visit__device__browser__name,
      visit__device__browser__user_agent,
      visit__device__browser__version,
      visit__device__device_form_factor,
      visit__device__device_type,
      visit__device__enc_uuid,
      visit__device__model,
      visit__device__operating_system,
      visit__location__enc_city,
      visit__location__enc_zip_code,
      visit__location__state,
      visit__login__logged_in,
      visit__login__login_duration_ms,
      visit__variant_uuids,
      visit__visit_id
FROm ${env:GLOBAL_DB}.core_quantum_events_sspp
WHERE partition_date_hour_utc >= '${hiveconf:START_DATE_TZ}'
AND partition_date_hour_utc <  '${hiveconf:END_DATE_TZ}'
AND visit__application_details__application_name
  IN ('SpecNet',
      'SMB',
      'MySpectrum',
      'IDManagement',
      'PrivacyMicrosite',
      'SpecMobile',
      'SpectrumCommunitySolutions'
     )
AND(
    (domain = 'portals')
    OR
    (qa__discard = FALSE
      AND
      message__name = 'apiCall')
             )
) dictionary

GROUP BY
  CASE
    WHEN  visit__account__details__mso IN ('CHARTER','CHTR','"CHTR"')       THEN 'L-CHTR'
    WHEN  visit__account__details__mso IN ('TWC','"TWC"', 'NONECAPTURED')   THEN 'L-TWC'
    WHEN  visit__account__details__mso IN ('BH','BHN','"BHN"')              THEN 'L-BHN'
    WHEN (visit__account__details__mso IN ('','unknown','"NONE"', 'NONE')
          OR visit__account__details__mso IS NULL )                         THEN 'MSO-MISSING'
    ELSE visit__account__details__mso
  END,
 visit__application_details__application_type,
LOWER(visit__device__device_type),
visit__device__model,
visit__connection__connection_type,
visit__connection__network_status,
state__content__stream__playback_type,
IF(visit__application_details__application_type = 'Android', IF(visit__device__operating_system   RLIKE '^(Android 4.0)' OR visit__device__operating_system RLIKE '^(Android 4.1)' OR   visit__device__operating_system RLIKE '^(Android 4.2)' OR visit__device__operating_system RLIKE  '^(Android 4.3)', 'Android 4.1 - 4.3', 'Android 4.4+'), NULL),
CASE
  WHEN visit__application_details__application_type IN('iOS','Android') THEN 'Mobile'
  WHEN visit__application_details__application_type IN('Xbox','SamsungTV') THEN 'Connected Devices'
 ELSE visit__application_details__application_type
END,
state__content__stream__playback_id,
visit__visit_id,
visit__device__enc_uuid,
visit__account__enc_account_number,
visit__variant_uuids,
state__content__details__episode_number,
state__content__details__season_number,
state__content__details__genres,
state__content__programmer__linear__channel_name,
visit__device__browser__name,
visit__device__browser__user_agent,
visit__device__browser__version,
state__content__identifiers__tms_program_id,
visit__account__enc_account_billing_id,
visit__account__enc_account_billing_division,
visit__account__enc_account_billing_division_id,
visit__location__enc_city,
visit__location__state,
visit__location__enc_zip_code,
visit__application_details__app_version,
state__content__content_class,
CONCAT(
visit__account__enc_account_billing_division_id ,
visit__account__enc_account_billing_division ,
visit__account__enc_account_billing_id
),
IF(LOWER(visit__application_details__application_name) IN('oneapp','specu','bulkmdu'), 'IPTV',  LOWER(visit__application_details__application_name)),
LOWER(visit__application_details__application_name),
visit__login__logged_in,
visit__device__operating_system,
visit__device__device_form_factor,
visit__account__details__billing_status,
visit__account__details__auto_pay_status,
visit__account__enc_account_number,
visit__activated_experiments,
visit__application_details__technology_type,
cast(NULL as INT),
epoch_converter(received__timestamp, 'America/Denver')
;
