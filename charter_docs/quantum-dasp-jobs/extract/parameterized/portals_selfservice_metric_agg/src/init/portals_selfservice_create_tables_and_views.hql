CREATE EXTERNAL TABLE IF NOT EXISTS ${db_name}.quantum_metric_agg_portals
(
  mso STRING,
  application_type STRING,
  device_type STRING,
  connection_type STRING,
  network_status STRING,
  playback_type STRING,
  cust_type STRING,
  stream_subtype String,
  android_type STRING,
  application_group_type STRING,
  stream_id STRING,
  visit_id STRING,
  device_id STRING,
  acct_id STRING,
  unique_stream_id STRING,
  unique_visit_id STRING,
  unique_device_id STRING,
  unique_account_number STRING,
  variant_uuids array<string>,
  episode_number STRING,
  season_number STRING,
  genres array<string>,
  linear_channel_name STRING,
  browser_name STRING,
  browser_user_agent STRING,
  browser_version STRING,
  tms_program_id STRING,
  min_received_timestamp BIGINT,
  max_received_timestamp BIGINT,
  manual_login_success BIGINT,
  manual_login_attempt BIGINT,
  resume_login_success BIGINT,
  resume_login_attempt BIGINT,
  verifier_login_success BIGINT,
  verifier_login_attempt BIGINT,
  manual_duration_ms_list ARRAY<INT>,
  verifier_duration_ms_list ARRAY<INT>,
  token_exchange_attempts BIGINT,
  stream_init_failures BIGINT,
  tune_time_ms_sum BIGINT,
  tune_time_count BIGINT,
  tune_time_ms_list ARRAY<INT>,
  watch_time_ms BIGINT,
  buffering_time_ms BIGINT,
  bitrate_downshifts BIGINT,
  stream_init_starts BIGINT,
  stream_noninit_failures BIGINT,
  bandwidth_consumed_mb DOUBLE,
  bitrate_content_elapsed_ms BIGINT,
  api_search_error_count INT,
  keyword_search INT,
  predictive_search INT,
  search_closed BIGINT,
  search_entered BIGINT,
  search_entered_space BIGINT,
  search_entered_total BIGINT,
  search_response_time_ms_list ARRAY<INT>,
  search_result_selected INT,
  search_result_type_list ARRAY<STRING>,
  search_started BIGINT,
  search_text_length BIGINT,
  zero_results BIGINT,
  zero_results_space BIGINT,
  billing_division STRING,
  billing_id STRING,
  location_city STRING,
  location_state STRING,
  location_zipcode STRING,
  app_version STRING,
  complete_buffering_time_ms_list ARRAY<INT>,
  complete_manual_duration_ms_list ARRAY<INT>,
  complete_tune_time_ms_list ARRAY<INT>,
  complete_verifier_duration_ms_list ARRAY<INT>,
  complete_watch_time_ms ARRAY<INT>,
  nonactive_account_number STRING,
  nonactive_device_id STRING,
  nonactive_stream_id STRING,
  nonactive_visit_id STRING,
  device_model STRING,
  critical_api_attempts INT,
  critical_api_fails INT,
  application_errors INT,
  critical_api_success INT,
  other_api_response_count INT,
  stream_choice STRING,
  content_class STRING,
  billing_division_id STRING,
  billing_combo_key STRING,
  app_vertical STRING,
  application_name STRING,
  logged_in STRING,
  operating_system STRING,
  form_factor STRING,
  billing_status STRING,
  autopay_status STRING,

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
  portals_access_voice_platform_via_tile INT,
  portals_account_billing_support_views INT,
  portals_account_settings_click_install_wifi_profile INT,
  portals_account_settings_click_manage_people INT,
  portals_account_settings_click_save_contact_info INT,
  portals_account_settings_home_page_views INT,
  portals_account_settings_manage_contact_info_page_views INT,
  portals_account_settings_manage_people_page_views INT,
  portals_account_settings_your_info_tab_views INT,
  portals_all_equipment_reset_flow_failures INT,
  portals_all_equipment_reset_flow_starts INT,
  portals_all_equipment_reset_flow_successes INT,
  portals_asd_paperless_enroll INT,
  portals_auth_homepage_page_views INT,
  portals_bill_delivery_pref_exit INT,
  portals_bill_delivery_pref_keep_paperless INT,
  portals_bill_delivery_pref_manage_paperless INT,
  portals_bill_delivery_pref_paper INT,
  portals_bill_delivery_pref_paper_failure INT,
  portals_bill_delivery_pref_paper_success INT,
  portals_bill_delivery_pref_paperless_enroll_from_homepage INT,
  portals_bill_delivery_pref_paperless_failure INT,
  portals_bill_delivery_pref_paperless_submit INT,
  portals_bill_delivery_pref_paperless_submit_from_billinghome INT,
  portals_bill_delivery_pref_paperless_submit_from_homepage INT,
  portals_bill_delivery_pref_paperless_success INT,
  portals_billing_feature_interaction INT,
  portals_billing_feature_page_view INT,
  portals_biometrics_fingerprint_enroll INT,
  portals_call_support INT,
  portals_cancel_pause_device INT,
  portals_cancel_tutorial_equip_page_three INT,
  portals_cancel_tutorial_otp_page_two INT,
  portals_cancel_tutorial_start_page_one INT,
  portals_cancel_unpause_device INT,
  portals_cancelled_service_appointment_start INT,
  portals_cancelled_service_appointments INT,
  portals_confirm_remove_device INT,
  portals_contact_us_page_views INT,
  portals_csat_campaign_dismiss INT,
  portals_csat_campaign_interaction INT,
  portals_csat_submit_feedback_cancel_written_feedback INT,
  portals_csat_submit_rating_1_very_dissatisfied INT,
  portals_csat_submit_rating_2_dissatisfied INT,
  portals_csat_submit_rating_3_neutral INT,
  portals_csat_submit_rating_4_satisfied INT,
  portals_csat_submit_rating_5_very_satisfied INT,
  portals_csat_submit_rating_all INT,
  portals_csat_submit_written_feedback INT,
  portals_download_wifi_profile_button_click INT,
  portals_download_wifi_profile_button_click_android INT,
  portals_download_wifi_profile_button_click_ios INT,
  portals_download_wifi_profile_success INT,
  portals_download_wifi_profile_success_android INT,
  portals_ed_my_internet_services INT,
  portals_ed_my_voice_services INT,
  portals_equipment_cancel_edit_ssid_select_action INT,
  portals_equipment_confirm_edit_ssid_select_action INT,
  portals_equipment_detail_views INT,
  portals_equipment_edit_ssid_select_action INT,
  portals_equipment_feature_interaction INT,
  portals_equipment_list_view INT,
  portals_equipment_reset_flow_submit_all INT,
  portals_footer_getsupport_acct_support INT,
  portals_footer_getsupport_support_home INT,
  portals_forgot_password_flow_start INT,
  portals_forgot_password_success INT,
  portals_forgot_username_flow_start INT,
  portals_forgot_username_success INT,
  portals_guided_tour_click_next INT,
  portals_guided_tour_exit INT,
  portals_guided_tour_initiated_modal_view INT,
  portals_guided_tour_one_of_three INT,
  portals_guided_tour_show_me_later INT,
  portals_guided_tour_three_of_three INT,
  portals_guided_tour_two_of_three INT,
  portals_install_wifi_profile_start INT,
  portals_install_wifi_profile_success INT,
  portals_internet_equipment_reset_flow_failures INT,
  portals_internet_equipment_reset_flow_starts INT,
  portals_internet_equipment_reset_flow_submit INT,
  portals_internet_equipment_reset_flow_successes INT,
  portals_internet_modem_reset_failures INT,
  portals_internet_modem_router_reset_starts INT,
  portals_internet_router_reset_failures INT,
  portals_internet_router_reset_successes INT,
  portals_internet_support_views INT,
  portals_iva_opens INT,
  portals_localnav_billing INT,
  portals_login_attempts INT,
  portals_login_failures INT,
  portals_logout INT,
  portals_manage_auto_payment_cancel INT,
  portals_manage_auto_payment_starts INT,
  portals_manage_auto_payment_successes INT,
  portals_manual_reset_failures INT,
  portals_manual_reset_starts INT,
  portals_manual_reset_success INT,
  portals_msa_experience_feedback_click_submit_feedback INT,
  portals_msa_experience_feedback_goal_accomplished INT,
  portals_msa_experience_feedback_goal_not_accomplished INT,
  portals_one_time_alert_clicked INT,
  portals_one_time_page_alert_displayed INT,
  portals_one_time_payment_amount INT,
  portals_one_time_payment_checking INT,
  portals_one_time_payment_checking_account INT,
  portals_one_time_payment_credit INT,
  portals_one_time_payment_credit_debit_card INT,
  portals_one_time_payment_date INT,
  portals_one_time_payment_date_other INT,
  portals_one_time_payment_date_past_due INT,
  portals_one_time_payment_date_today INT,
  portals_one_time_payment_failures INT,
  portals_one_time_payment_savings INT,
  portals_one_time_payment_savings_account INT,
  portals_one_time_payment_select_amount INT,
  portals_one_time_payment_select_date INT,
  portals_one_time_payment_select_payment_method INT,
  portals_one_time_payment_starts INT,
  portals_one_time_payment_submission_new_payment_method INT,
  portals_one_time_payment_submission_new_payment_method_not_stored INT,
  portals_one_time_payment_submission_new_payment_method_stored INT,
  portals_one_time_payment_submission_previously_stored_payment_method INT,
  portals_one_time_payment_submits INT,
  portals_one_time_payment_submits_with_ap INT,
  portals_one_time_payment_submits_without_ap INT,
  portals_one_time_payment_successes INT,
  portals_one_time_payment_successes_with_ap_enroll INT,
  portals_one_time_payment_successes_without_ap_enroll INT,
  portals_page_views INT,
  portals_paperless_radio_toggle INT,
  portals_paperless_toggle INT,
  portals_rescheduled_service_appointment_start INT,
  portals_rescheduled_service_appointments INT,
  portals_router_advanced_settings_click_about_port_forward INT,
  portals_router_advanced_settings_click_add_port_assignment INT,
  portals_router_advanced_settings_click_cancel_dns_change INT,
  portals_router_advanced_settings_click_cancel_port_assignment INT,
  portals_router_advanced_settings_click_create_ip_reservation INT,
  portals_router_advanced_settings_click_delete_or_cancel_delete_port INT,
  portals_router_advanced_settings_click_delete_port INT,
  portals_router_advanced_settings_click_dns INT,
  portals_router_advanced_settings_click_manage_dns INT,
  portals_router_advanced_settings_click_manage_ip_reservations INT,
  portals_router_advanced_settings_click_port_forward INT,
  portals_router_advanced_settings_click_reset_dns_default INT,
  portals_router_advanced_settings_click_save_confirm_dns INT,
  portals_router_advanced_settings_click_spectrum_dns_default INT,
  portals_router_advanced_settings_click_upnp INT,
  portals_router_advanced_settings_click_use_existing_port INT,
  portals_router_advanced_settings_delete_port_assignment_via_swipe INT,
  portals_router_advanced_settings_port_unavailable_modal INT,
  portals_router_advanced_settings_reserve_ip_toggle_off INT,
  portals_router_advanced_settings_reserve_ip_toggle_on INT,
  portals_router_advanced_settings_upnp_toggle_off INT,
  portals_router_advanced_settings_upnp_toggle_on INT,
  portals_save_edit_device_nickname INT,
  portals_scp_click_cancel_pause_device INT,
  portals_scp_click_cancel_unpause_device INT,
  portals_scp_click_not_connected_devices_tab INT,
  portals_scp_click_pause_device INT,
  portals_scp_click_paused_tab INT,
  portals_scp_click_unpause_device INT,
  portals_scp_final_confirm_create_pod_name_failure INT,
  portals_scp_final_confirm_create_pod_name_success INT,
  portals_scp_final_confirm_device_nickname_change_failure INT,
  portals_scp_final_confirm_device_nickname_change_success INT,
  portals_scp_final_confirm_device_type_and_nickname_change_failure INT,
  portals_scp_final_confirm_device_type_and_nickname_change_success INT,
  portals_scp_final_confirm_device_type_icon_update_failure INT,
  portals_scp_final_confirm_device_type_icon_update_success INT,
  portals_scp_final_confirm_edit_pod_name_failure INT,
  portals_scp_final_confirm_edit_pod_name_success INT,
  portals_scp_final_confirm_pause_failure INT,
  portals_scp_final_confirm_pause_success INT,
  portals_scp_final_confirm_refresh_pod_failure INT,
  portals_scp_final_confirm_refresh_pod_success INT,
  portals_scp_final_confirm_remove_device_failure INT,
  portals_scp_final_confirm_remove_device_success INT,
  portals_scp_final_confirm_unpause_failure INT,
  portals_scp_final_confirm_unpause_success INT,
  portals_scp_list_of_pods_pv INT,
  portals_scp_pod_details_pv INT,
  portals_scp_remove_device_cancel INT,
  portals_scp_select_pod_from_list INT,
  portals_security_qa_campaign_interaction INT,
  portals_security_qa_update_security_page_view INT,
  portals_select_actions INT,
  portals_set_up_auto_payment_failures INT,
  portals_set_up_auto_payment_starts INT,
  portals_set_up_auto_payment_submits INT,
  portals_set_up_auto_payment_submits_plus_otp INT,
  portals_set_up_auto_payment_successes INT,
  portals_set_up_auto_payment_successes_with_payment INT,
  portals_set_up_auto_payment_successes_without_payment INT,
  portals_settings_sign_in_security_manage_select_action INT,
  portals_settings_sign_in_security_subnav_people_select_action INT,
  portals_settings_verify_select_action INT,
  portals_settings_your_info_changes_success INT,
  portals_settings_your_info_manage_select_action INT,
  portals_settings_your_info_save_select_action INT,
  portals_settings_your_info_verify_identity_modal_view INT,
  portals_settings_your_info_verify_success INT,
  portals_site_unique INT,
  portals_site_unique_auth INT,
  portals_site_unique_mobile INT,
  portals_site_unique_pc INT,
  portals_start_pause_device INT,
  portals_start_unpause_device INT,
  portals_support_article_select INT,
  portals_support_button INT,
  portals_support_page_views INT,
  portals_tech_tracker_auth_views INT,
  portals_tech_tracker_unauth_views INT,
  portals_tutorial_account_page_five_page_view INT,
  portals_tutorial_account_page_four_page_view INT,
  portals_tutorial_equip_page_three_page_view INT,
  portals_tutorial_otp_page_two_page_view INT,
  portals_tutorial_start_page_one_page_view INT,
  portals_tutorial_views INT,
  portals_tv_equipment_reset_flow_failures INT,
  portals_tv_equipment_reset_flow_starts INT,
  portals_tv_equipment_reset_flow_submit INT,
  portals_tv_equipment_reset_flow_successes INT,
  portals_tv_modem_reset_failures INT,
  portals_tv_router_reset_failures INT,
  portals_unauth_homepage_page_views INT,
  portals_update_missing_contact_campaign_interaction INT,
  portals_update_missing_contact_cancel_close_window INT,
  portals_update_missing_contact_save INT,
  portals_update_missing_contact_save_all INT,
  portals_update_missing_contact_save_and_continue INT,
  portals_update_missing_contact_skip_this INT,
  portals_update_missing_contact_update_all INT,
  portals_upgrade_links_overview INT,
  portals_upgrade_service_internet INT,
  portals_video_support_views INT,
  portals_view_connected_devices INT,
  portals_view_online_statments INT,
  portals_voice_delete_messages INT,
  portals_voice_equipment_reset_flow_failures INT,
  portals_voice_equipment_reset_flow_starts INT,
  portals_voice_equipment_reset_flow_submit INT,
  portals_voice_equipment_reset_flow_successes INT,
  portals_voice_modem_reset_failures INT,
  portals_voice_pageviews INT,
  portals_voice_play_messages INT,
  portals_voice_router_reset_failures INT,
  portals_voice_support_views INT,
  portals_voice_update_call_forward_settings INT,
  portals_voice_view_messages INT,
  portals_voice_voicemail_view_select_action INT,
  portals_wifi_password_views INT,
  portals_wifi_pw_changes INT,
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
portals_unique_acct_key STRING,
activated_experiments map<string,string>,
technology_type STRING,
calls_within_24_hrs INT
),

PARTITIONED BY (denver_date STRING)
STORED AS ORC
LOCATION '${s3_location}'
TBLPROPERTIES ('orc.compress'='SNAPPY',
               'retention_policy'='Aggregate - With PII (3 Years)');
