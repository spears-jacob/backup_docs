-- comment to push through pipeline
CREATE EXTERNAL TABLE IF NOT EXISTS ${db_name}.quantum_metric_agg_portals
(
  mso string,
  application_type string,
  device_type string,
  connection_type string,
  network_status string,
  playback_type string,
  cust_type string,
  stream_subtype string,
  android_type string,
  application_group_type string,
  stream_id string,
  visit_id string,
  device_id string,
  acct_id string,
  unique_stream_id string,
  unique_visit_id string,
  unique_device_id string,
  unique_account_number string,
  variant_uuids array<string>,
  episode_number string,
  season_number string,
  genres array<string>,
  linear_channel_name string,
  browser_name string,
  browser_user_agent string,
  browser_version string,
  tms_program_id string,
  min_received_timestamp bigint,
  max_received_timestamp bigint,
  manual_login_success bigint,
  manual_login_attempt bigint,
  resume_login_success bigint,
  resume_login_attempt bigint,
  verifier_login_success bigint,
  verifier_login_attempt bigint,
  manual_duration_ms_list array<int>,
  verifier_duration_ms_list array<int>,
  token_exchange_attempts bigint,
  stream_init_failures bigint,
  tune_time_ms_sum bigint,
  tune_time_count bigint,
  tune_time_ms_list array<int>,
  watch_time_ms bigint,
  buffering_time_ms bigint,
  bitrate_downshifts bigint,
  stream_init_starts bigint,
  stream_noninit_failures bigint,
  bandwidth_consumed_mb double,
  bitrate_content_elapsed_ms bigint,
  api_search_error_count int,
  keyword_search int,
  predictive_search int,
  search_closed bigint,
  search_entered bigint,
  search_entered_space bigint,
  search_entered_total bigint,
  search_response_time_ms_list array<int>,
  search_result_selected int,
  search_result_type_list array<string>,
  search_started bigint,
  search_text_length bigint,
  zero_results bigint,
  zero_results_space bigint,
  billing_division string,
  billing_id string,
  location_city string,
  location_state string,
  location_zipcode string,
  app_version string,
  complete_buffering_time_ms_list array<int>,
  complete_manual_duration_ms_list array<int>,
  complete_tune_time_ms_list array<int>,
  complete_verifier_duration_ms_list array<int>,
  complete_watch_time_ms array<int>,
  nonactive_account_number string,
  nonactive_device_id string,
  nonactive_stream_id string,
  nonactive_visit_id string,
  device_model string,
  critical_api_attempts int,
  critical_api_fails int,
  application_errors int,
  critical_api_success int,
  other_api_response_count int,
  stream_choice string,
  content_class string,
  billing_division_id string,
  billing_combo_key string,
  app_vertical string,
  application_name string,
  logged_in string,
  operating_system string,
  form_factor string,
  billing_status string,
  autopay_status string,
  portals_access_voice_platform_via_tile int,
  portals_account_billing_support_views int,
  portals_account_settings_click_install_wifi_profile int,
  portals_account_settings_click_manage_people int,
  portals_account_settings_click_save_contact_info int,
  portals_account_settings_home_page_views int,
  portals_account_settings_manage_contact_info_page_views int,
  portals_account_settings_manage_people_page_views int,
  portals_account_settings_your_info_tab_views int,
  portals_all_equipment_reset_flow_failures int,
  portals_all_equipment_reset_flow_starts int,
  portals_all_equipment_reset_flow_successes int,
  portals_asd_paperless_enroll int,
  portals_auth_homepage_page_views int,
  portals_bill_delivery_pref_exit int,
  portals_bill_delivery_pref_keep_paperless int,
  portals_bill_delivery_pref_manage_paperless int,
  portals_bill_delivery_pref_paper int,
  portals_bill_delivery_pref_paper_failure int,
  portals_bill_delivery_pref_paper_success int,
  portals_bill_delivery_pref_paperless_enroll_from_homepage int,
  portals_bill_delivery_pref_paperless_failure int,
  portals_bill_delivery_pref_paperless_submit int,
  portals_bill_delivery_pref_paperless_submit_from_billinghome int,
  portals_bill_delivery_pref_paperless_submit_from_homepage int,
  portals_bill_delivery_pref_paperless_success int,
  portals_billing_feature_interaction int,
  portals_billing_feature_page_view int,
  portals_biometrics_fingerprint_enroll int,
  portals_call_support int,
  portals_cancel_pause_device int,
  portals_cancel_tutorial_equip_page_three int,
  portals_cancel_tutorial_otp_page_two int,
  portals_cancel_tutorial_start_page_one int,
  portals_cancel_unpause_device int,
  portals_cancelled_service_appointment_start int,
  portals_cancelled_service_appointments int,
  portals_confirm_remove_device int,
  portals_contact_us_page_views int,
  portals_csat_campaign_dismiss int,
  portals_csat_campaign_interaction int,
  portals_csat_submit_feedback_cancel_written_feedback int,
  portals_csat_submit_rating_1_very_dissatisfied int,
  portals_csat_submit_rating_2_dissatisfied int,
  portals_csat_submit_rating_3_neutral int,
  portals_csat_submit_rating_4_satisfied int,
  portals_csat_submit_rating_5_very_satisfied int,
  portals_csat_submit_rating_all int,
  portals_csat_submit_written_feedback int,
  portals_download_wifi_profile_button_click int,
  portals_download_wifi_profile_button_click_android int,
  portals_download_wifi_profile_button_click_ios int,
  portals_download_wifi_profile_success int,
  portals_download_wifi_profile_success_android int,
  portals_ed_my_internet_services int,
  portals_ed_my_voice_services int,
  portals_equipment_cancel_edit_ssid_select_action int,
  portals_equipment_confirm_edit_ssid_select_action int,
  portals_equipment_detail_views int,
  portals_equipment_edit_ssid_select_action int,
  portals_equipment_feature_interaction int,
  portals_equipment_list_view int,
  portals_equipment_reset_flow_submit_all int,
  portals_footer_getsupport_acct_support int,
  portals_footer_getsupport_support_home int,
  portals_forgot_password_flow_start int,
  portals_forgot_password_success int,
  portals_forgot_username_flow_start int,
  portals_forgot_username_success int,
  portals_guided_tour_click_next int,
  portals_guided_tour_exit int,
  portals_guided_tour_initiated_modal_view int,
  portals_guided_tour_one_of_three int,
  portals_guided_tour_show_me_later int,
  portals_guided_tour_three_of_three int,
  portals_guided_tour_two_of_three int,
  portals_install_wifi_profile_start int,
  portals_install_wifi_profile_success int,
  portals_internet_equipment_reset_flow_failures int,
  portals_internet_equipment_reset_flow_starts int,
  portals_internet_equipment_reset_flow_submit int,
  portals_internet_equipment_reset_flow_successes int,
  portals_internet_modem_reset_failures int,
  portals_internet_modem_router_reset_starts int,
  portals_internet_router_reset_failures int,
  portals_internet_router_reset_successes int,
  portals_internet_support_views int,
  portals_iva_opens int,
  portals_localnav_billing int,
  portals_login_attempts int,
  portals_login_failures int,
  portals_logout int,
  portals_manage_auto_payment_cancel int,
  portals_manage_auto_payment_starts int,
  portals_manage_auto_payment_successes int,
  portals_manual_reset_failures int,
  portals_manual_reset_starts int,
  portals_manual_reset_success int,
  portals_msa_experience_feedback_click_submit_feedback int,
  portals_msa_experience_feedback_goal_accomplished int,
  portals_msa_experience_feedback_goal_not_accomplished int,
  portals_one_time_alert_clicked int,
  portals_one_time_page_alert_displayed int,
  portals_one_time_payment_amount int,
  portals_one_time_payment_checking int,
  portals_one_time_payment_checking_account int,
  portals_one_time_payment_credit int,
  portals_one_time_payment_credit_debit_card int,
  portals_one_time_payment_date int,
  portals_one_time_payment_date_other int,
  portals_one_time_payment_date_past_due int,
  portals_one_time_payment_date_today int,
  portals_one_time_payment_failures int,
  portals_one_time_payment_savings int,
  portals_one_time_payment_savings_account int,
  portals_one_time_payment_select_amount int,
  portals_one_time_payment_select_date int,
  portals_one_time_payment_select_payment_method int,
  portals_one_time_payment_starts int,
  portals_one_time_payment_submission_new_payment_method int,
  portals_one_time_payment_submission_new_payment_method_not_stored int,
  portals_one_time_payment_submission_new_payment_method_stored int,
  portals_one_time_payment_submission_previously_stored_payment_method int,
  portals_one_time_payment_submits int,
  portals_one_time_payment_submits_with_ap int,
  portals_one_time_payment_submits_without_ap int,
  portals_one_time_payment_successes int,
  portals_one_time_payment_successes_with_ap_enroll int,
  portals_one_time_payment_successes_without_ap_enroll int,
  portals_page_views int,
  portals_paperless_radio_toggle int,
  portals_paperless_toggle int,
  portals_rescheduled_service_appointment_start int,
  portals_rescheduled_service_appointments int,
  portals_router_advanced_settings_click_about_port_forward int,
  portals_router_advanced_settings_click_add_port_assignment int,
  portals_router_advanced_settings_click_cancel_dns_change int,
  portals_router_advanced_settings_click_cancel_port_assignment int,
  portals_router_advanced_settings_click_create_ip_reservation int,
  portals_router_advanced_settings_click_delete_or_cancel_delete_port int,
  portals_router_advanced_settings_click_delete_port int,
  portals_router_advanced_settings_click_dns int,
  portals_router_advanced_settings_click_manage_dns int,
  portals_router_advanced_settings_click_manage_ip_reservations int,
  portals_router_advanced_settings_click_port_forward int,
  portals_router_advanced_settings_click_reset_dns_default int,
  portals_router_advanced_settings_click_save_confirm_dns int,
  portals_router_advanced_settings_click_spectrum_dns_default int,
  portals_router_advanced_settings_click_upnp int,
  portals_router_advanced_settings_click_use_existing_port int,
  portals_router_advanced_settings_delete_port_assignment_via_swipe int,
  portals_router_advanced_settings_port_unavailable_modal int,
  portals_router_advanced_settings_reserve_ip_toggle_off int,
  portals_router_advanced_settings_reserve_ip_toggle_on int,
  portals_router_advanced_settings_upnp_toggle_off int,
  portals_router_advanced_settings_upnp_toggle_on int,
  portals_save_edit_device_nickname int,
  portals_scp_click_cancel_pause_device int,
  portals_scp_click_cancel_unpause_device int,
  portals_scp_click_not_connected_devices_tab int,
  portals_scp_click_pause_device int,
  portals_scp_click_paused_tab int,
  portals_scp_click_unpause_device int,
  portals_scp_final_confirm_create_pod_name_failure int,
  portals_scp_final_confirm_create_pod_name_success int,
  portals_scp_final_confirm_device_nickname_change_failure int,
  portals_scp_final_confirm_device_nickname_change_success int,
  portals_scp_final_confirm_device_type_and_nickname_change_failure int,
  portals_scp_final_confirm_device_type_and_nickname_change_success int,
  portals_scp_final_confirm_device_type_icon_update_failure int,
  portals_scp_final_confirm_device_type_icon_update_success int,
  portals_scp_final_confirm_edit_pod_name_failure int,
  portals_scp_final_confirm_edit_pod_name_success int,
  portals_scp_final_confirm_pause_failure int,
  portals_scp_final_confirm_pause_success int,
  portals_scp_final_confirm_refresh_pod_failure int,
  portals_scp_final_confirm_refresh_pod_success int,
  portals_scp_final_confirm_remove_device_failure int,
  portals_scp_final_confirm_remove_device_success int,
  portals_scp_final_confirm_unpause_failure int,
  portals_scp_final_confirm_unpause_success int,
  portals_scp_list_of_pods_pv int,
  portals_scp_pod_details_pv int,
  portals_scp_remove_device_cancel int,
  portals_scp_select_pod_from_list int,
  portals_security_qa_campaign_interaction int,
  portals_security_qa_update_security_page_view int,
  portals_select_actions int,
  portals_set_up_auto_payment_failures int,
  portals_set_up_auto_payment_starts int,
  portals_set_up_auto_payment_submits int,
  portals_set_up_auto_payment_submits_plus_otp int,
  portals_set_up_auto_payment_successes int,
  portals_set_up_auto_payment_successes_with_payment int,
  portals_set_up_auto_payment_successes_without_payment int,
  portals_settings_sign_in_security_manage_select_action int,
  portals_settings_sign_in_security_subnav_people_select_action int,
  portals_settings_verify_select_action int,
  portals_settings_your_info_changes_success int,
  portals_settings_your_info_manage_select_action int,
  portals_settings_your_info_save_select_action int,
  portals_settings_your_info_verify_identity_modal_view int,
  portals_settings_your_info_verify_success int,
  portals_site_unique int,
  portals_site_unique_auth int,
  portals_site_unique_mobile int,
  portals_site_unique_pc int,
  portals_start_pause_device int,
  portals_start_unpause_device int,
  portals_support_article_select int,
  portals_support_button int,
  portals_support_page_views int,
  portals_tech_tracker_auth_views int,
  portals_tech_tracker_unauth_views int,
  portals_tutorial_account_page_five_page_view int,
  portals_tutorial_account_page_four_page_view int,
  portals_tutorial_equip_page_three_page_view int,
  portals_tutorial_otp_page_two_page_view int,
  portals_tutorial_start_page_one_page_view int,
  portals_tutorial_views int,
  portals_tv_equipment_reset_flow_failures int,
  portals_tv_equipment_reset_flow_starts int,
  portals_tv_equipment_reset_flow_submit int,
  portals_tv_equipment_reset_flow_successes int,
  portals_tv_modem_reset_failures int,
  portals_tv_router_reset_failures int,
  portals_unauth_homepage_page_views int,
  portals_update_missing_contact_campaign_interaction int,
  portals_update_missing_contact_cancel_close_window int,
  portals_update_missing_contact_save int,
  portals_update_missing_contact_save_all int,
  portals_update_missing_contact_save_and_continue int,
  portals_update_missing_contact_skip_this int,
  portals_update_missing_contact_update_all int,
  portals_upgrade_links_overview int,
  portals_upgrade_service_internet int,
  portals_video_support_views int,
  portals_view_connected_devices int,
  portals_view_online_statments int,
  portals_voice_delete_messages int,
  portals_voice_equipment_reset_flow_failures int,
  portals_voice_equipment_reset_flow_starts int,
  portals_voice_equipment_reset_flow_submit int,
  portals_voice_equipment_reset_flow_successes int,
  portals_voice_modem_reset_failures int,
  portals_voice_pageviews int,
  portals_voice_play_messages int,
  portals_voice_router_reset_failures int,
  portals_voice_support_views int,
  portals_voice_update_call_forward_settings int,
  portals_voice_view_messages int,
  portals_voice_voicemail_view_select_action int,
  portals_wifi_password_views int,
  portals_wifi_pw_changes int,
  portals_unique_acct_key string,
  activated_experiments map<string,string>,
  technology_type STRING,
  calls_within_24_hrs INT)

PARTITIONED BY (denver_date STRING)
STORED AS ORC
LOCATION '${s3_location}'
TBLPROPERTIES ("orc.compress"="SNAPPY")
;
