set hive.vectorized.execution.enabled = false;

USE prod;

DROP TABLE IF EXISTS ${env:TMP_db}.asp_venona_counts_weekly_counts_devices_columns;
CREATE TEMPORARY TABLE ${env:TMP_db}.asp_venona_counts_weekly_counts_devices_columns AS
    SELECT
        COALESCE (visit__account__details__mso,'Unknown') as company,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_name) = LOWER('billing-and-transactions')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('ask-spectrum') , visit__device__enc_uuid, Null))) AS ask_spectrum_from_billing_post_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('ask-spectrum')   AND LOWER(state__view__current_page__page_name) = LOWER('my-internet-services') , visit__device__enc_uuid, Null))) AS ask_spectrum_from_my_internet_services_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('ask-spectrum')   AND LOWER(state__view__current_page__page_name) = LOWER('my-tv-services') , visit__device__enc_uuid, Null))) AS ask_spectrum_from_my_tv_services_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('ask-spectrum')   AND LOWER(state__view__current_page__page_name) = LOWER('my-voice-services') , visit__device__enc_uuid, Null))) AS ask_spectrum_from_my_voice_services_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated') , visit__device__enc_uuid, Null))) AS auth_homepage_page_views_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStop')   AND LOWER(message__feature__feature_name) IN (LOWER('autoPayEnrollment'),LOWER('manageAutoPay'))   AND operation__success IS NULL   AND LOWER(message__event_case_id) NOT RLIKE LOWER('.*Cancelled.*') , visit__device__enc_uuid, Null))) AS set_up_auto_payment_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND (message__event_case_id IN ('SPECNET_billPay_billPayStop_autopayEnrolled_triggeredByApplicationSuccess', 'SPECNET_billPay_billPayStop_autopayEnrollmentWithPayment_triggeredByApplicationSuccess')) , visit__device__enc_uuid, Null))) AS set_up_auto_payment_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('pay-bill.enroll-in-autopay-no-balance-checking'),LOWER('pay-bill.enroll-in-autopay-no-balance-savings'),LOWER('pay-bill.enroll-in-autopay-no-balance-credit'),LOWER('pay-bill.enroll-in-autopay-with-balance-credit'),LOWER('pay-bill.enroll-in-autopay-with-balance-checking'),LOWER('pay-bill.enroll-in-autopay-with-balance-savings')) , visit__device__enc_uuid, Null))) AS autopay_confirmation_post_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND visit__account__details__billing_status RLIKE '.*bp:autopay.*' , visit__device__enc_uuid, Null))) AS autopay_is_enabled_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND visit__account__details__billing_status RLIKE '.*bp:no-autopay.*' , visit__device__enc_uuid, Null))) AS autopay_is_not_enabled_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStart')   AND LOWER(message__feature__feature_name) = LOWER('autoPayEnrollment') , visit__device__enc_uuid, Null))) AS autopay_step1_post_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('pay-bill.view-bill-details-hp'),LOWER('pay-bill.enroll-in-autopay-hp'),LOWER('pay-bill.make-a-payment-hp')) , visit__device__enc_uuid, Null))) AS bill_pay_clicks_from_bill_pay_card_on_hp_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-billing') , visit__device__enc_uuid, Null))) AS bill_pay_clicks_from_local_nav_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('pay-bill.enroll-in-autopay-no-balance-checking'),LOWER('pay-bill.enroll-in-autopay-no-balance-savings'),LOWER('pay-bill.enroll-in-autopay-no-balance-credit'),LOWER('pay-bill.enroll-in-autopay-with-balance-credit'),LOWER('pay-bill.enroll-in-autopay-with-balance-checking'),LOWER('pay-bill.enroll-in-autopay-with-balance-savings')) , visit__device__enc_uuid, Null))) AS bill_flow_ap_step1_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStop')   AND LOWER(message__feature__feature_name) IN (LOWER('autoPayEnrollment'),LOWER('manageAutoPay'))   AND LOWER(operation__success) = LOWER('True')   AND LOWER(message__feature__feature_step_name) <> LOWER('autopayChangesConfirmation') , visit__device__enc_uuid, Null))) AS bill_flow_ap_step2_confirm_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) RLIKE LOWER('pay-bill.onetime.payment-amount.*') , visit__device__enc_uuid, Null))) AS bill_flow_otp_step1_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) RLIKE LOWER('pay-bill.onetime.payment-date.continue.*') , visit__device__enc_uuid, Null))) AS bill_flow_otp_step2_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('pay-bill.onetime.payment-method.credit'),LOWER('pay-bill.onetime.payment-method.checking'),LOWER('pay-bill.onetime.payment-method.savings')) , visit__device__enc_uuid, Null))) AS bill_flow_otp_step3_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('pay-bill.onetime.payment-review.make-payment'),LOWER('pay-bill.onetime.payment-review.pay-and-enroll')) , visit__device__enc_uuid, Null))) AS bill_flow_otp_step4_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStop')   AND LOWER(message__feature__feature_name) = LOWER('oneTimeBillPayFlow')   AND LOWER(operation__success) = LOWER('True') , visit__device__enc_uuid, Null))) AS bill_flow_otp_step5_confirm_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND visit__account__details__billing_status RLIKE '.*pastDue-no.*' , visit__device__enc_uuid, Null))) AS bill_status_past_due_no_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND visit__account__details__billing_status RLIKE '.*pastDue-yes.*' , visit__device__enc_uuid, Null))) AS bill_status_past_due_yes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('apiCall')   AND LOWER(application__api__api_name) = LOWER('serviceapptedgeV1AppointmentsCancel') , visit__device__enc_uuid, Null))) AS cancelled_service_appointments_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStop')   AND LOWER(message__feature__feature_name) = LOWER('oneTimeBillPayFlow')   AND LOWER(operation__success) = LOWER('True') , visit__device__enc_uuid, Null))) AS combined_payment_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('contactUs') , visit__device__enc_uuid, Null))) AS contact_us_page_views_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS create_username_referred_from_msa_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND visit__device__operating_system RLIKE '.*iOS|Android.*' , visit__device__enc_uuid, Null))) AS site_unique_mobile_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND visit__device__operating_system NOT RLIKE '.*iOS|Android.*' , visit__device__enc_uuid, Null))) AS site_unique_pc_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.internet.troubleshoot.reset-equip.cancel') , visit__device__enc_uuid, Null))) AS ed_equip_internet_troubleshoot_reset_equip_cancel_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('equip.internet.troubleshoot.reset-equip.reset-failure-modal-continues')) , visit__device__enc_uuid, Null))) AS ed_equip_internet_troubleshoot_reset_equip_reset_failure_modal_continue_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.internet.troubleshoot.reset-equip.start') , visit__device__enc_uuid, Null))) AS ed_equip_internet_troubleshoot_reset_equip_start_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.internet.troubleshoot.reset-equip.success-modal-continue') , visit__device__enc_uuid, Null))) AS ed_equip_internet_troubleshoot_reset_equip_success_modal_continue_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('support-category.internet.reset-modem.issue-resolved')) , visit__device__enc_uuid, Null))) AS ed_equip_internet_troubleshoot_reset_equip_success_modal_issue_resolved_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.tv.troubleshoot.reset-equip.cancel') , visit__device__enc_uuid, Null))) AS ed_equip_tv_troubleshoot_reset_equip_cancel_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('equip.tv.troubleshoot.reset-equip.reset-failure-modal-continue')) , visit__device__enc_uuid, Null))) AS ed_equip_tv_troubleshoot_reset_equip_reset_failure_modal_continue_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.tv.troubleshoot.reset-equip.start') , visit__device__enc_uuid, Null))) AS ed_equip_tv_troubleshoot_reset_equip_start_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.tv.troubleshoot.reset-equip.success-modal-continue') , visit__device__enc_uuid, Null))) AS ed_equip_tv_troubleshoot_reset_equip_success_modal_continue_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('support-category.tv.reset-equip.issue-resolved')) , visit__device__enc_uuid, Null))) AS ed_equip_tv_troubleshoot_reset_equip_success_modal_issue_resolved_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.voice.troubleshoot.reset-equip.cancel') , visit__device__enc_uuid, Null))) AS ed_equip_voice_troubleshoot_reset_equip_cancel_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('equip.voice.troubleshoot.reset-equip.reset-failure-modal-continue')) , visit__device__enc_uuid, Null))) AS ed_equip_voice_troubleshoot_reset_equip_reset_failure_modal_continue_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.voice.troubleshoot.reset-equip.start') , visit__device__enc_uuid, Null))) AS ed_equip_voice_troubleshoot_reset_equip_start_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equip.voice.troubleshoot.reset-equip.success-modal-continue') , visit__device__enc_uuid, Null))) AS ed_equip_voice_troubleshoot_reset_equip_success_modal_continue_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('support-category.voice.reset-equip.issue-resolved')) , visit__device__enc_uuid, Null))) AS ed_equip_voice_troubleshoot_reset_equip_success_modal_issue_resolved_devices,
        SIZE(COLLECT_SET(IF( LOWER(state__view__current_page__app_section) IN (LOWER('tv'),LOWER('voice'),LOWER('internet'))  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__app_section) = LOWER('support') , visit__device__enc_uuid, Null))) AS equipment_page_views_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('reset-equipment-tv-failure', 'reset-equipment-voice-failure', 'reset-equipment-internet-failure') , visit__device__enc_uuid, Null))) AS all_equipment_reset_flow_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) =  'reset-equipment-internet-failure' , visit__device__enc_uuid, Null))) AS internet_equipment_reset_flow_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) =  'reset-equipment-tv-failure' , visit__device__enc_uuid, Null))) AS tv_equipment_reset_flow_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) =  'reset-equipment-voice-failure' , visit__device__enc_uuid, Null))) AS voice_equipment_reset_flow_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN ('equipment.internet.troubleshoot', 'equipment.tv.troubleshoot', 'equipment.voice.troubleshoot') , visit__device__enc_uuid, Null))) AS all_equipment_reset_flow_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = 'equipment.internet.troubleshoot' , visit__device__enc_uuid, Null))) AS internet_equipment_reset_flow_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = 'specnet'  AND message__name = 'modalView'   AND message__feature__feature_name = 'tvTroubleshoot'   AND message__feature__feature_step_name = 'resetSuccessModal'   AND state__view__modal__name = 'Reset-Equipment-Success' , visit__device__enc_uuid, Null))) AS tv_equipment_reset_flow_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) =  'equipment.voice.troubleshoot' , visit__device__enc_uuid, Null))) AS voice_equipment_reset_flow_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = 'specnet'  AND message__name = 'modalView'   AND message__feature__feature_name IN( 'internetTroubleshoot', 'tvTroubleshoot', 'voiceTroubleshoot')   AND message__feature__feature_step_name = 'resetSuccessModal'   AND state__view__modal__name = 'Reset-Equipment-Success' , visit__device__enc_uuid, Null))) AS all_equipment_reset_flow_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) =  'reset-equipment-internet-success' , visit__device__enc_uuid, Null))) AS internet_equipment_reset_flow_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) =  'reset-equipment-tv-success' , visit__device__enc_uuid, Null))) AS tv_equipment_reset_flow_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) =  'reset-equipment-voice-success' , visit__device__enc_uuid, Null))) AS voice_equipment_reset_flow_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-accountSummary') , visit__device__enc_uuid, Null))) AS footer_manageaccount_account_summary_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-getSupport-accountSupport') , visit__device__enc_uuid, Null))) AS footer_getsupport_acct_support_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-billing') , visit__device__enc_uuid, Null))) AS footer_manageaccount_billing_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-legal-californiaPrivacyRights') , visit__device__enc_uuid, Null))) AS footer_legal_ca_privacy_rights_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-contact-contactUs') , visit__device__enc_uuid, Null))) AS footer_contactus_contact_us_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-disabilityAssistance') , visit__device__enc_uuid, Null))) AS footer_disability_assistance_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-social-facebook') , visit__device__enc_uuid, Null))) AS footer_social_facebook_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-contact-findStore') , visit__device__enc_uuid, Null))) AS footer_contactus_find_spectrum_store_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-contact-websiteFeedback') , visit__device__enc_uuid, Null))) AS footer_contactus_give_website_feedback_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-legal-goToAssist') , visit__device__enc_uuid, Null))) AS footer_legal_go_to_assist_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-watchTV-guide') , visit__device__enc_uuid, Null))) AS footer_watchtv_guide_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-social-instagram') , visit__device__enc_uuid, Null))) AS footer_social_instagram_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-internet') , visit__device__enc_uuid, Null))) AS footer_getsupport_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-internet') , visit__device__enc_uuid, Null))) AS footer_manageaccount_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-watchTV-liveTV') , visit__device__enc_uuid, Null))) AS footer_watchtv_live_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-mobile') , visit__device__enc_uuid, Null))) AS footer_manageaccount_mobile_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-watchTV-myLibrary') , visit__device__enc_uuid, Null))) AS footer_watchtv_my_library_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-watchTV-onDemand') , visit__device__enc_uuid, Null))) AS footer_watchtv_on_demand_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-legal-policies') , visit__device__enc_uuid, Null))) AS footer_legal_policies_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-legal-privacyRights') , visit__device__enc_uuid, Null))) AS footer_legal_privacy_rights_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-settings') , visit__device__enc_uuid, Null))) AS footer_manageaccount_settings_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-getSupport-supportHome') , visit__device__enc_uuid, Null))) AS footer_getsupport_support_home_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-tv') , visit__device__enc_uuid, Null))) AS footer_getsupport_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-tv') , visit__device__enc_uuid, Null))) AS footer_manageaccount_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-watchTV-dvr') , visit__device__enc_uuid, Null))) AS footer_watchtv_dvr_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-social-twitter') , visit__device__enc_uuid, Null))) AS footer_social_twitter_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-voice') , visit__device__enc_uuid, Null))) AS footer_getsupport_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-manageAccount-voice') , visit__device__enc_uuid, Null))) AS footer_manageaccount_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-contact-weatherOutage') , visit__device__enc_uuid, Null))) AS footer_contactus_weather_outage_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('footer-social-youtube') , visit__device__enc_uuid, Null))) AS footer_social_youtube_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS forgot_password_referred_from_msa_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS forgot_username_referred_from_msa_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('internetAddService') , visit__device__enc_uuid, Null))) AS from_homepage_banner_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('tvAddService') , visit__device__enc_uuid, Null))) AS from_homepage_banner_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('voiceAddService') , visit__device__enc_uuid, Null))) AS from_homepage_banner_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('my-internet-services')   AND LOWER(state__view__previous_page__app_section) = LOWER('support') , visit__device__enc_uuid, Null))) AS from_support_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('my-tv-services')   AND LOWER(state__view__previous_page__app_section) = LOWER('support') , visit__device__enc_uuid, Null))) AS from_support_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('my-voice-services')   AND LOWER(state__view__previous_page__app_section) = LOWER('support') , visit__device__enc_uuid, Null))) AS from_support_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-closeSideNav') , visit__device__enc_uuid, Null))) AS hamburger_closesidenav_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-createUsername') , visit__device__enc_uuid, Null))) AS hamburger_create_username_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-email') , visit__device__enc_uuid, Null))) AS hamburger_email_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-getSupport') , visit__device__enc_uuid, Null))) AS hamburger_get_support_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-manageAccount') , visit__device__enc_uuid, Null))) AS hamburger_manage_account_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-signin') , visit__device__enc_uuid, Null))) AS hamburger_signin_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-signout') , visit__device__enc_uuid, Null))) AS hamburger_signout_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-voice') , visit__device__enc_uuid, Null))) AS hamburger_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('hamburger-watchTV') , visit__device__enc_uuid, Null))) AS hamburger_watch_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('ask-spectrum'),LOWER('askSpectrumNextIT'),LOWER('askSpectrumASAPP')) , visit__device__enc_uuid, Null))) AS iva_opens_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-accountSummary') , visit__device__enc_uuid, Null))) AS localnav_acct_summary_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-billing') , visit__device__enc_uuid, Null))) AS localnav_billing_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-internet') , visit__device__enc_uuid, Null))) AS localnav_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-settings') , visit__device__enc_uuid, Null))) AS localnav_settings_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-tv') , visit__device__enc_uuid, Null))) AS localnav_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('localNav-voice') , visit__device__enc_uuid, Null))) AS localnav_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('loginStop') , visit__device__enc_uuid, Null))) AS login_attempts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('support-category.voice.reset-equip.contact-us'),LOWER('support-category.internet.reset-equip.contact-us'),LOWER('support-category.tv.reset-equip.contact-us')) , visit__device__enc_uuid, Null))) AS manual_reset_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-voice-services.manually-reset-equipment'),LOWER('my-tv-services.manually-reset-equipment'),LOWER('my-internet-services.manually-reset-equipment')) , visit__device__enc_uuid, Null))) AS manual_reset_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('support-category.tv.reset-equip.issue-resolved'),LOWER('support-category.voice.reset-equip.issue-resolved'),LOWER('support-category.internet.reset-modem.issue-resolved')) , visit__device__enc_uuid, Null))) AS manual_reset_success_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-voice-services.manually-reset-equipment'),LOWER('my-tv-services.manually-reset-equipment'),LOWER('my-internet-services.manually-reset-equipment')) , visit__device__enc_uuid, Null))) AS manual_troubleshoot_page_views_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS internet_modem_reset_failures_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS voice_modem_reset_failures_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS internet_modem_reset_successes_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS voice_modem_reset_successes_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS internet_modem_router_reset_starts_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS voice_modem_router_reset_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__app_section) IN (LOWER('tv'),LOWER('voice'),LOWER('internet'))   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-internet-services')) , visit__device__enc_uuid, Null))) AS ed_my_internet_services_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-internet-services.contact-us')) , visit__device__enc_uuid, Null))) AS ed_my_internet_services_contact_us_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-internet-services.manually-reset-equipment')) , visit__device__enc_uuid, Null))) AS ed_my_internet_services_manually_reset_equipment_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__app_section) IN (LOWER('tv'),LOWER('voice'),LOWER('internet'))   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-tv-services')) , visit__device__enc_uuid, Null))) AS ed_my_tv_services_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-tv-services.contact-us')) , visit__device__enc_uuid, Null))) AS ed_my_tv_services_contact_us_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-tv-services.manually-reset-equipment')) , visit__device__enc_uuid, Null))) AS ed_my_tv_services_manually_reset_equipment_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__app_section) IN (LOWER('tv'),LOWER('voice'),LOWER('internet'))   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-internet-services.contact-us'),LOWER('my-voice-services')) , visit__device__enc_uuid, Null))) AS ed_my_voice_services_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-voice-services.contact-us')) , visit__device__enc_uuid, Null))) AS ed_my_voice_services_contact_us_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) IN (LOWER('my-voice-services.manually-reset-equipment')) , visit__device__enc_uuid, Null))) AS ed_my_voice_services_manually_reset_equipment_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS new_ids_created_attempts_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS new_ids_created_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStop')   AND LOWER(message__feature__feature_name) = LOWER('oneTimeBillPayFlow')   AND operation__success IS NULL   AND LOWER(message__feature__feature_step_name) = LOWER('oneTimePaymentError') , visit__device__enc_uuid, Null))) AS one_time_payment_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStart')   AND LOWER(message__feature__feature_name) = LOWER('oneTimeBillPayFlow') , visit__device__enc_uuid, Null))) AS one_time_payment_starts_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND message__name = 'featureStop' AND message__feature__feature_name IN ('oneTimeBillPayFlow', 'oneTimePayment') AND operation__success = TRUE AND ((message__feature__feature_step_changed = FALSE AND message__event_case_id <> 'SPECNET_selectAction_billPayStop_otp_exitBillPayFlow') OR (message__feature__feature_step_name IN ('oneTimePaymentAppSuccess','oneTimePaymentAutoPayAppSuccess', 'paymentWithAutoPaySuccess', 'paymentSuccess') AND message__feature__feature_step_changed = TRUE)) , visit__device__enc_uuid, Null))) AS one_time_payment_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('featureStop')   AND LOWER(message__feature__feature_name) = LOWER('oneTimeBillPayFlow')   AND LOWER(message__feature__feature_step_name) = ('oneTimePaymentAutoPayError')   AND message__feature__feature_step_changed IS NOT NULL , visit__device__enc_uuid, Null))) AS otp_with_autopay_failures_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND message__name = 'featureStop' AND message__feature__feature_name IN ('oneTimeBillPayFlow', 'oneTimePayment') AND operation__success = TRUE AND message__feature__feature_step_name IN ('oneTimePaymentAutoPayAppSuccess', 'paymentWithAutoPaySuccess') AND message__feature__feature_step_changed = TRUE , visit__device__enc_uuid, Null))) AS otp_with_autopay_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND visit__account__details__billing_status RLIKE '.*pl:pl-yes.*' , visit__device__enc_uuid, Null))) AS paperless_billing_is_enabled_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND visit__account__details__billing_status RLIKE '.*pl:pl-no.*' , visit__device__enc_uuid, Null))) AS paperless_billing_is_not_enabled_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS password_reset_attempts_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS password_reset_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('Progress-Bar-Modal-Internet') , visit__device__enc_uuid, Null))) AS ed_progress_bar_modal_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('Progress-Bar-Modal-TV') , visit__device__enc_uuid, Null))) AS ed_progress_bar_modal_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('Progress-Bar-Modal-Voice') , visit__device__enc_uuid, Null))) AS ed_progress_bar_modal_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('apiCall')   AND LOWER(application__api__path) = LOWER('/api/pub/serviceapptedge/v1/appointments/reschedule') , visit__device__enc_uuid, Null))) AS rescheduled_service_appointments_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('Reset-Equipment-Internet') , visit__device__enc_uuid, Null))) AS ed_reset_equipment_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('Reset-Equipment-TV') , visit__device__enc_uuid, Null))) AS ed_reset_equipment_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN ('Reset-Equipment-Voice') , visit__device__enc_uuid, Null))) AS ed_reset_equipment_voice_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS internet_router_reset_failures_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS voice_router_reset_failures_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS internet_router_reset_successes_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS voice_router_reset_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('searched')   AND state__search__text IS NOT NULL , visit__device__enc_uuid, Null))) AS search_action_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(operation__operation_type) = LOWER('searchResultSelected') , visit__device__enc_uuid, Null))) AS search_results_clicked_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet'), visit__device__enc_uuid, Null))) AS site_unique_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('loginStop')   AND LOWER(operation__success) = LOWER('True') , visit__device__enc_uuid, Null))) AS site_unique_auth_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__app_section) = LOWER('support') , visit__device__enc_uuid, Null))) AS support_section_page_views_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('pageView')   AND LOWER(state__view__current_page__page_name) = LOWER('home-unauth') , visit__device__enc_uuid, Null))) AS unauth_homepage_page_views_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_name) = LOWER('home-authenticated')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('Upgrade-Overview-Banner') , visit__device__enc_uuid, Null))) AS upgrade_links_overview_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.internet.upgrade-service') , visit__device__enc_uuid, Null))) AS upgrade_service_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.tv.upgrade-service') , visit__device__enc_uuid, Null))) AS upgrade_service_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.voice.upgrade-your-service') , visit__device__enc_uuid, Null))) AS upgrade_service_voice_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS username_recovery_attempts_devices,
        SIZE(COLLECT_SET(IF( FALSE, visit__device__enc_uuid, Null))) AS username_recovery_successes_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('utilityNav-email') , visit__device__enc_uuid, Null))) AS utilitynav_email_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('utilityNav-support') , visit__device__enc_uuid, Null))) AS utilitynav_support_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('utilityNav-voice') , visit__device__enc_uuid, Null))) AS utilitynav_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.tv.expand-device') , visit__device__enc_uuid, Null))) AS view_equipment_details_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.voice.expand-device') , visit__device__enc_uuid, Null))) AS view_equipment_details_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND message__name = 'selectAction'    AND state__view__current_page__elements__standardized_name IN( 'downloadStatement', 'pay-bill.billing-statement-download') , visit__device__enc_uuid, Null))) AS view_online_statement_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.tv.view-troubleshooting-video')   AND LOWER(state__view__current_page__page_name) = LOWER('my-tv-services') , visit__device__enc_uuid, Null))) AS view_support_video_tv_view_troubleshooting_video_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.tv.view-troubleshooting-video')   AND LOWER(state__view__current_page__page_name) = LOWER('my-internet-services') , visit__device__enc_uuid, Null))) AS view_support_video_voice_view_more_videos_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('equipment.voice.view-troubleshooting-video')   AND LOWER(state__view__current_page__page_name) = LOWER('my-voice-services') , visit__device__enc_uuid, Null))) AS view_support_video_voice_view_troubleshooting_video_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__elements__standardized_name) IN (LOWER('equipment.internet.check-email'),LOWER('utilityNav-email')) , visit__device__enc_uuid, Null))) AS webmail_views_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_section__name) = LOWER('equipment')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('internet') , visit__device__enc_uuid, Null))) AS yourservicesequip_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_section__name) = LOWER('equipment')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('mobile') , visit__device__enc_uuid, Null))) AS yourservicesequip_mobile_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_section__name) = LOWER('equipment')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('tv') , visit__device__enc_uuid, Null))) AS yourservicesequip_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('selectAction')   AND LOWER(state__view__current_page__page_section__name) = LOWER('equipment')   AND LOWER(state__view__current_page__elements__standardized_name) = LOWER('voice') , visit__device__enc_uuid, Null))) AS yourservicesequip_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) IN (LOWER('Wait-15-Error-Modal-Internet'),LOWER('Wait-15-Error-Modal-TV'),LOWER('Wait-15-Error-Modal-Voice')) , visit__device__enc_uuid, Null))) AS equipment_resets_too_many_resets_modal_all_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) = LOWER('Wait-15-Error-Modal-Internet') , visit__device__enc_uuid, Null))) AS equipment_resets_too_many_resets_modal_internet_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) = LOWER('Wait-15-Error-Modal-TV') , visit__device__enc_uuid, Null))) AS equipment_resets_too_many_resets_modal_tv_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(message__name) = LOWER('modalView')   AND LOWER(state__view__modal__name) = LOWER('Wait-15-Error-Modal-Voice') , visit__device__enc_uuid, Null))) AS equipment_resets_too_many_resets_modal_voice_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(visit__device__device_type) RLIKE LOWER('and.*') , visit__device__enc_uuid, Null))) AS os_android_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(visit__device__device_type) RLIKE LOWER('ip.*') , visit__device__enc_uuid, Null))) AS os_ios_devices,
        SIZE(COLLECT_SET(IF( LOWER(visit__application_details__application_name) = LOWER('SpecNet')  AND LOWER(visit__device__device_type) NOT RLIKE LOWER('ip.*')   AND LOWER(visit__device__device_type) NOT RLIKE LOWER('and.*') , visit__device__enc_uuid, Null))) AS os_other_devices,
        'asp' AS platform,
        'resi' AS domain,
        
        week_ending_date as week_ending_date_denver
    FROM asp_v_venona_events_portals_specnet
         LEFT JOIN prod_lkp.week_ending ON epoch_converter(cast(received__timestamp as bigint),'America/Denver') = partition_date
    WHERE (week_ending_date >= '${env:START_DATE}'
       AND week_ending_date <  '${env:END_DATE}')
    GROUP BY
        week_ending_date,
        
        COALESCE (visit__account__details__mso,'Unknown')
    ;
INSERT OVERWRITE TABLE prod.asp_venona_counts_weekly
PARTITION(unit,platform,domain,company,week_ending_date_denver,source_table)

    SELECT  value,
            metric,
            
            'devices',
            'asp',
            'resi',
            company,
            week_ending_date_denver,
            'asp_v_venona_events_portals_specnet'
    FROM (SELECT  company,
                  week_ending_date_denver,
                  
                  MAP(

                      'ask_spectrum_from_billing_post|Ask Spectrum From Billing Post|Spectrum.net||', ask_spectrum_from_billing_post_devices,
                      'ask_spectrum_from_my_internet_services|Ask Spectrum From My Internet Services|Spectrum.net||', ask_spectrum_from_my_internet_services_devices,
                      'ask_spectrum_from_my_tv_services|Ask Spectrum From My Tv Services|Spectrum.net||', ask_spectrum_from_my_tv_services_devices,
                      'ask_spectrum_from_my_voice_services|Ask Spectrum From My Voice Services|Spectrum.net||', ask_spectrum_from_my_voice_services_devices,
                      'auth_homepage_page_views|Authenticated Homepage Page Views|Spectrum.net||', auth_homepage_page_views_devices,
                      'set_up_auto_payment_failures|Auto Pay Enrollment Failures|Spectrum.net||', set_up_auto_payment_failures_devices,
                      'set_up_auto_payment_successes|Auto Pay Enrollment Successes|Spectrum.net||', set_up_auto_payment_successes_devices,
                      'autopay_confirmation_post|Autopay Confirmation Post|Spectrum.net||', autopay_confirmation_post_devices,
                      'autopay_is_enabled|Autopay Is Enabled|Spectrum.net||', autopay_is_enabled_devices,
                      'autopay_is_not_enabled|Autopay Is Not Enabled|Spectrum.net||', autopay_is_not_enabled_devices,
                      'autopay_step1_post|Autopay Step1 Post|Spectrum.net||', autopay_step1_post_devices,
                      'bill_pay_clicks_from_bill_pay_card_on_hp|Bill Pay Clicks From Bill Pay Card On Hp|Spectrum.net||', bill_pay_clicks_from_bill_pay_card_on_hp_devices,
                      'bill_pay_clicks_from_local_nav|Bill Pay Clicks From Local Nav|Spectrum.net||', bill_pay_clicks_from_local_nav_devices,
                      'bill_flow_ap_step1|Bill Pay Flow - Auto Pay Step 1|Spectrum.net||', bill_flow_ap_step1_devices,
                      'bill_flow_ap_step2_confirm|Bill Pay Flow - Auto Pay Step 2 / Confirm|Spectrum.net||', bill_flow_ap_step2_confirm_devices,
                      'bill_flow_otp_step1|Bill Pay Flow - One Time Payment Step 1|Spectrum.net||', bill_flow_otp_step1_devices,
                      'bill_flow_otp_step2|Bill Pay Flow - One Time Payment Step 2|Spectrum.net||', bill_flow_otp_step2_devices,
                      'bill_flow_otp_step3|Bill Pay Flow - One Time Payment Step 3|Spectrum.net||', bill_flow_otp_step3_devices,
                      'bill_flow_otp_step4|Bill Pay Flow - One Time Payment Step 4|Spectrum.net||', bill_flow_otp_step4_devices,
                      'bill_flow_otp_step5_confirm|Bill Pay Flow - One Time Payment Step 5 / Confirm|Spectrum.net||', bill_flow_otp_step5_confirm_devices,
                      'bill_status_past_due_no|Bill Status Past Due No|Spectrum.net||', bill_status_past_due_no_devices,
                      'bill_status_past_due_yes|Bill Status Past Due Yes|Spectrum.net||', bill_status_past_due_yes_devices,
                      'cancelled_service_appointments|Cancelled Service Appointments|Spectrum.net||', cancelled_service_appointments_devices,
                      'combined_payment_successes|Combined One Time Payment and Auto Pay with One Time Payment Successes|Spectrum.net||', combined_payment_successes_devices,
                      'contact_us_page_views|Contact Us Page Views|Spectrum.net||', contact_us_page_views_devices,
                      'create_username_referred_from_msa|Create Username Referral From MySpectrum App|Spectrum.net||', create_username_referred_from_msa_devices,
                      'site_unique_mobile|Device Count Mobile|Spectrum.net||', site_unique_mobile_devices,
                      'site_unique_pc|Device Count PC|Spectrum.net||', site_unique_pc_devices,
                      'ed_equip_internet_troubleshoot_reset_equip_cancel|Equip Internet Troubleshoot Reset Equip Cancel|Spectrum.net||', ed_equip_internet_troubleshoot_reset_equip_cancel_devices,
                      'ed_equip_internet_troubleshoot_reset_equip_reset_failure_modal_continue|Equip Internet Troubleshoot Reset Equip Reset Failure Modal Continue|Spectrum.net||', ed_equip_internet_troubleshoot_reset_equip_reset_failure_modal_continue_devices,
                      'ed_equip_internet_troubleshoot_reset_equip_start|Equip Internet Troubleshoot Reset Equip Start|Spectrum.net||', ed_equip_internet_troubleshoot_reset_equip_start_devices,
                      'ed_equip_internet_troubleshoot_reset_equip_success_modal_continue|Equip Internet Troubleshoot Reset Equip Success Modal Continue|Spectrum.net||', ed_equip_internet_troubleshoot_reset_equip_success_modal_continue_devices,
                      'ed_equip_internet_troubleshoot_reset_equip_success_modal_issue_resolved|Equip Internet Troubleshoot Reset Equip Success Modal Issue Resolved|Spectrum.net||', ed_equip_internet_troubleshoot_reset_equip_success_modal_issue_resolved_devices,
                      'ed_equip_tv_troubleshoot_reset_equip_cancel|Equip Tv Troubleshoot Reset Equip Cancel|Spectrum.net||', ed_equip_tv_troubleshoot_reset_equip_cancel_devices,
                      'ed_equip_tv_troubleshoot_reset_equip_reset_failure_modal_continue|Equip Tv Troubleshoot Reset Equip Reset Failure Modal Continue|Spectrum.net||', ed_equip_tv_troubleshoot_reset_equip_reset_failure_modal_continue_devices,
                      'ed_equip_tv_troubleshoot_reset_equip_start|Equip Tv Troubleshoot Reset Equip Start|Spectrum.net||', ed_equip_tv_troubleshoot_reset_equip_start_devices,
                      'ed_equip_tv_troubleshoot_reset_equip_success_modal_continue|Equip Tv Troubleshoot Reset Equip Success Modal Continue|Spectrum.net||', ed_equip_tv_troubleshoot_reset_equip_success_modal_continue_devices,
                      'ed_equip_tv_troubleshoot_reset_equip_success_modal_issue_resolved|Equip Tv Troubleshoot Reset Equip Success Modal Issue Resolved|Spectrum.net||', ed_equip_tv_troubleshoot_reset_equip_success_modal_issue_resolved_devices,
                      'ed_equip_voice_troubleshoot_reset_equip_cancel|Equip Voice Troubleshoot Reset Equip Cancel|Spectrum.net||', ed_equip_voice_troubleshoot_reset_equip_cancel_devices,
                      'ed_equip_voice_troubleshoot_reset_equip_reset_failure_modal_continue|Equip Voice Troubleshoot Reset Equip Reset Failure Modal Continue|Spectrum.net||', ed_equip_voice_troubleshoot_reset_equip_reset_failure_modal_continue_devices,
                      'ed_equip_voice_troubleshoot_reset_equip_start|Equip Voice Troubleshoot Reset Equip Start|Spectrum.net||', ed_equip_voice_troubleshoot_reset_equip_start_devices,
                      'ed_equip_voice_troubleshoot_reset_equip_success_modal_continue|Equip Voice Troubleshoot Reset Equip Success Modal Continue|Spectrum.net||', ed_equip_voice_troubleshoot_reset_equip_success_modal_continue_devices,
                      'ed_equip_voice_troubleshoot_reset_equip_success_modal_issue_resolved|Equip Voice Troubleshoot Reset Equip Success Modal Issue Resolved|Spectrum.net||', ed_equip_voice_troubleshoot_reset_equip_success_modal_issue_resolved_devices,
                      'equipment_page_views|Equipment Flow Page Views|Spectrum.net||', equipment_page_views_devices,
                      'all_equipment_reset_flow_failures|Equipment Reset Flow Failures All|Spectrum.net||', all_equipment_reset_flow_failures_devices,
                      'internet_equipment_reset_flow_failures|Equipment Reset Flow Failures Internet|Spectrum.net||', internet_equipment_reset_flow_failures_devices,
                      'tv_equipment_reset_flow_failures|Equipment Reset Flow Failures TV|Spectrum.net||', tv_equipment_reset_flow_failures_devices,
                      'voice_equipment_reset_flow_failures|Equipment Reset Flow Failures Voice|Spectrum.net||', voice_equipment_reset_flow_failures_devices,
                      'all_equipment_reset_flow_starts|Equipment Reset Flow Starts All|Spectrum.net||', all_equipment_reset_flow_starts_devices,
                      'internet_equipment_reset_flow_starts|Equipment Reset Flow Starts Internet|Spectrum.net||', internet_equipment_reset_flow_starts_devices,
                      'tv_equipment_reset_flow_starts|Equipment Reset Flow Starts TV|Spectrum.net||', tv_equipment_reset_flow_starts_devices,
                      'voice_equipment_reset_flow_starts|Equipment Reset Flow Starts Voice|Spectrum.net||', voice_equipment_reset_flow_starts_devices,
                      'all_equipment_reset_flow_successes|Equipment Reset Flow Successes All|Spectrum.net||', all_equipment_reset_flow_successes_devices,
                      'internet_equipment_reset_flow_successes|Equipment Reset Flow Successes Internet|Spectrum.net||', internet_equipment_reset_flow_successes_devices,
                      'tv_equipment_reset_flow_successes|Equipment Reset Flow Successes TV|Spectrum.net||', tv_equipment_reset_flow_successes_devices,
                      'voice_equipment_reset_flow_successes|Equipment Reset Flow Successes Voice|Spectrum.net||', voice_equipment_reset_flow_successes_devices,
                      'footer_manageaccount_account_summary|Footer - Account Summary|Spectrum.net||', footer_manageaccount_account_summary_devices,
                      'footer_getsupport_acct_support|Footer - Acct Support|Spectrum.net||', footer_getsupport_acct_support_devices,
                      'footer_manageaccount_billing|Footer - Billing|Spectrum.net||', footer_manageaccount_billing_devices,
                      'footer_legal_ca_privacy_rights|Footer - CA Privacy Rights|Spectrum.net||', footer_legal_ca_privacy_rights_devices,
                      'footer_contactus_contact_us|Footer - Contact Us|Spectrum.net||', footer_contactus_contact_us_devices,
                      'footer_disability_assistance|Footer - Disability Assistance|Spectrum.net||', footer_disability_assistance_devices,
                      'footer_social_facebook|Footer - Facebook|Spectrum.net||', footer_social_facebook_devices,
                      'footer_contactus_find_spectrum_store|Footer - Find a Spectrum Store|Spectrum.net||', footer_contactus_find_spectrum_store_devices,
                      'footer_contactus_give_website_feedback|Footer - Give Website Feedback |Spectrum.net||', footer_contactus_give_website_feedback_devices,
                      'footer_legal_go_to_assist|Footer - Go to Assist|Spectrum.net||', footer_legal_go_to_assist_devices,
                      'footer_watchtv_guide|Footer - Guide|Spectrum.net||', footer_watchtv_guide_devices,
                      'footer_social_instagram|Footer - Instagram|Spectrum.net||', footer_social_instagram_devices,
                      'footer_getsupport_internet|Footer - Internet|Spectrum.net||', footer_getsupport_internet_devices,
                      'footer_manageaccount_internet|Footer - Internet|Spectrum.net||', footer_manageaccount_internet_devices,
                      'footer_watchtv_live_tv|Footer - Live TV|Spectrum.net||', footer_watchtv_live_tv_devices,
                      'footer_manageaccount_mobile|Footer - Mobile|Spectrum.net||', footer_manageaccount_mobile_devices,
                      'footer_watchtv_my_library|Footer - My Library|Spectrum.net||', footer_watchtv_my_library_devices,
                      'footer_watchtv_on_demand|Footer - On Demand|Spectrum.net||', footer_watchtv_on_demand_devices,
                      'footer_legal_policies|Footer - Policies|Spectrum.net||', footer_legal_policies_devices,
                      'footer_legal_privacy_rights|Footer - Privacy Rights|Spectrum.net||', footer_legal_privacy_rights_devices,
                      'footer_manageaccount_settings|Footer - Settings|Spectrum.net||', footer_manageaccount_settings_devices,
                      'footer_getsupport_support_home|Footer - Support Home|Spectrum.net||', footer_getsupport_support_home_devices,
                      'footer_getsupport_tv|Footer - TV|Spectrum.net||', footer_getsupport_tv_devices,
                      'footer_manageaccount_tv|Footer - TV|Spectrum.net||', footer_manageaccount_tv_devices,
                      'footer_watchtv_dvr|Footer - TV DVR|Spectrum.net||', footer_watchtv_dvr_devices,
                      'footer_social_twitter|Footer - Twitter|Spectrum.net||', footer_social_twitter_devices,
                      'footer_getsupport_voice|Footer - Voice|Spectrum.net||', footer_getsupport_voice_devices,
                      'footer_manageaccount_voice|Footer - Voice|Spectrum.net||', footer_manageaccount_voice_devices,
                      'footer_contactus_weather_outage|Footer - Weather Outage|Spectrum.net||', footer_contactus_weather_outage_devices,
                      'footer_social_youtube|Footer - Youtube|Spectrum.net||', footer_social_youtube_devices,
                      'forgot_password_referred_from_msa|Forgot Password Referral From MySpectrum App|Spectrum.net||', forgot_password_referred_from_msa_devices,
                      'forgot_username_referred_from_msa|Forgot Username Referral From MySpectrum App|Spectrum.net||', forgot_username_referred_from_msa_devices,
                      'from_homepage_banner_internet|From Homepage Banner Internet|Spectrum.net||', from_homepage_banner_internet_devices,
                      'from_homepage_banner_tv|From Homepage Banner Tv|Spectrum.net||', from_homepage_banner_tv_devices,
                      'from_homepage_banner_voice|From Homepage Banner Voice|Spectrum.net||', from_homepage_banner_voice_devices,
                      'from_support_internet|From Support Internet|Spectrum.net||', from_support_internet_devices,
                      'from_support_tv|From Support Tv|Spectrum.net||', from_support_tv_devices,
                      'from_support_voice|From Support Voice|Spectrum.net||', from_support_voice_devices,
                      'hamburger_closesidenav|Hamburger - closeSideNav|Spectrum.net||', hamburger_closesidenav_devices,
                      'hamburger_create_username|Hamburger - Create Username|Spectrum.net||', hamburger_create_username_devices,
                      'hamburger_email|Hamburger - Email|Spectrum.net||', hamburger_email_devices,
                      'hamburger_get_support|Hamburger - Get Support|Spectrum.net||', hamburger_get_support_devices,
                      'hamburger_manage_account|Hamburger - Manage Account|Spectrum.net||', hamburger_manage_account_devices,
                      'hamburger_signin|Hamburger - Sign In|Spectrum.net||', hamburger_signin_devices,
                      'hamburger_signout|Hamburger - Signout|Spectrum.net||', hamburger_signout_devices,
                      'hamburger_voice|Hamburger - Voice|Spectrum.net||', hamburger_voice_devices,
                      'hamburger_watch_tv|Hamburger - Watch TV|Spectrum.net||', hamburger_watch_tv_devices,
                      'iva_opens|IVA Opens|Spectrum.net||', iva_opens_devices,
                      'localnav_acct_summary|LocalNav - Account Summary|Spectrum.net||', localnav_acct_summary_devices,
                      'localnav_billing|LocalNav - Billing|Spectrum.net||', localnav_billing_devices,
                      'localnav_internet|LocalNav - Internet|Spectrum.net||', localnav_internet_devices,
                      'localnav_settings|LocalNav - Settings|Spectrum.net||', localnav_settings_devices,
                      'localnav_tv|LocalNav - TV|Spectrum.net||', localnav_tv_devices,
                      'localnav_voice|LocalNav - Voice|Spectrum.net||', localnav_voice_devices,
                      'login_attempts|Login Attempts|Spectrum.net||', login_attempts_devices,
                      'manual_reset_failures|Manual Reset Failures|Spectrum.net||', manual_reset_failures_devices,
                      'manual_reset_starts|Manual Reset Starts|Spectrum.net||', manual_reset_starts_devices,
                      'manual_reset_success|Manual Reset Success|Spectrum.net||', manual_reset_success_devices,
                      'manual_troubleshoot_page_views|Manual Troubleshooting Page Views|Spectrum.net||', manual_troubleshoot_page_views_devices,
                      'internet_modem_reset_failures|Modem Reset Failures Internet|Spectrum.net||', internet_modem_reset_failures_devices,
                      'voice_modem_reset_failures|Modem Reset Failures Voice|Spectrum.net||', voice_modem_reset_failures_devices,
                      'internet_modem_reset_successes|Modem Reset Successes Internet|Spectrum.net||', internet_modem_reset_successes_devices,
                      'voice_modem_reset_successes|Modem Reset Successes Voice|Spectrum.net||', voice_modem_reset_successes_devices,
                      'internet_modem_router_reset_starts|Modem Router Reset Starts Internet|Spectrum.net||', internet_modem_router_reset_starts_devices,
                      'voice_modem_router_reset_starts|Modem Router Reset Starts Voice|Spectrum.net||', voice_modem_router_reset_starts_devices,
                      'ed_my_internet_services|My Internet Services|Spectrum.net||', ed_my_internet_services_devices,
                      'ed_my_internet_services_contact_us|My Internet Services Contact Us|Spectrum.net||', ed_my_internet_services_contact_us_devices,
                      'ed_my_internet_services_manually_reset_equipment|My Internet Services Manually Reset Equipment|Spectrum.net||', ed_my_internet_services_manually_reset_equipment_devices,
                      'ed_my_tv_services|My Tv Services|Spectrum.net||', ed_my_tv_services_devices,
                      'ed_my_tv_services_contact_us|My Tv Services Contact Us|Spectrum.net||', ed_my_tv_services_contact_us_devices,
                      'ed_my_tv_services_manually_reset_equipment|My Tv Services Manually Reset Equipment|Spectrum.net||', ed_my_tv_services_manually_reset_equipment_devices,
                      'ed_my_voice_services|My Voice Services|Spectrum.net||', ed_my_voice_services_devices,
                      'ed_my_voice_services_contact_us|My Voice Services Contact Us|Spectrum.net||', ed_my_voice_services_contact_us_devices,
                      'ed_my_voice_services_manually_reset_equipment|My Voice Services Manually Reset Equipment|Spectrum.net||', ed_my_voice_services_manually_reset_equipment_devices,
                      'new_ids_created_attempts|New IDs Created Attempts|Spectrum.net||', new_ids_created_attempts_devices,
                      'new_ids_created_successes|New IDs Created Successes|Spectrum.net||', new_ids_created_successes_devices,
                      'one_time_payment_failures|One Time Payment Failures|Spectrum.net||', one_time_payment_failures_devices,
                      'one_time_payment_starts|One Time Payment Starts|Spectrum.net||', one_time_payment_starts_devices,
                      'one_time_payment_successes|One Time Payment Successes|Spectrum.net||', one_time_payment_successes_devices,
                      'otp_with_autopay_failures|One Time Payment with Auto Pay Enrollment Failures|Spectrum.net||', otp_with_autopay_failures_devices,
                      'otp_with_autopay_successes|One Time Payment with Auto Pay Enrollment Successes|Spectrum.net||', otp_with_autopay_successes_devices,
                      'paperless_billing_is_enabled|Paperless Billing is Enabled|Spectrum.net||', paperless_billing_is_enabled_devices,
                      'paperless_billing_is_not_enabled|Paperless Billing Is Not Enabled|Spectrum.net||', paperless_billing_is_not_enabled_devices,
                      'password_reset_attempts|Password Reset Attempts|Spectrum.net||', password_reset_attempts_devices,
                      'password_reset_successes|Password Reset Successes|Spectrum.net||', password_reset_successes_devices,
                      'ed_progress_bar_modal_internet|Progress Bar Modal Internet|Spectrum.net||', ed_progress_bar_modal_internet_devices,
                      'ed_progress_bar_modal_tv|Progress Bar Modal Tv|Spectrum.net||', ed_progress_bar_modal_tv_devices,
                      'ed_progress_bar_modal_voice|Progress Bar Modal Voice|Spectrum.net||', ed_progress_bar_modal_voice_devices,
                      'rescheduled_service_appointments|Rescheduled Service Appointments|Spectrum.net||', rescheduled_service_appointments_devices,
                      'ed_reset_equipment_internet|Reset Equipment Internet|Spectrum.net||', ed_reset_equipment_internet_devices,
                      'ed_reset_equipment_tv|Reset Equipment TV|Spectrum.net||', ed_reset_equipment_tv_devices,
                      'ed_reset_equipment_voice|Reset Equipment Voice|Spectrum.net||', ed_reset_equipment_voice_devices,
                      'internet_router_reset_failures|Router Reset Failures Internet|Spectrum.net||', internet_router_reset_failures_devices,
                      'voice_router_reset_failures|Router Reset Failures Voice|Spectrum.net||', voice_router_reset_failures_devices,
                      'internet_router_reset_successes|Router Reset Successes Internet|Spectrum.net||', internet_router_reset_successes_devices,
                      'voice_router_reset_successes|Router Reset Successes Voice|Spectrum.net||', voice_router_reset_successes_devices,
                      'search_action|Search Action|Spectrum.net||', search_action_devices,
                      'search_results_clicked|Search Results Clicked|Spectrum.net||', search_results_clicked_devices,
                      'site_unique|Site Unique Values|Spectrum.net||', site_unique_devices,
                      'site_unique_auth|Site Unique Values Authenticated|Spectrum.net||', site_unique_auth_devices,
                      'support_section_page_views|Support Section Page Views|Spectrum.net||', support_section_page_views_devices,
                      'unauth_homepage_page_views|Unauthenticated Homepage Page Views|Spectrum.net||', unauth_homepage_page_views_devices,
                      'upgrade_links_overview|Upgrade Links Overview|Spectrum.net||', upgrade_links_overview_devices,
                      'upgrade_service_internet|Upgrade Service Internet|Spectrum.net||', upgrade_service_internet_devices,
                      'upgrade_service_tv|Upgrade Service Tv|Spectrum.net||', upgrade_service_tv_devices,
                      'upgrade_service_voice|Upgrade Service Voice|Spectrum.net||', upgrade_service_voice_devices,
                      'username_recovery_attempts|Username Recovery Attempts|Spectrum.net||', username_recovery_attempts_devices,
                      'username_recovery_successes|Username Recovery Successes|Spectrum.net||', username_recovery_successes_devices,
                      'utilitynav_email|Utility Navigation - Email|Spectrum.net||', utilitynav_email_devices,
                      'utilitynav_support|Utility Navigation - Support|Spectrum.net||', utilitynav_support_devices,
                      'utilitynav_voice|Utility Navigation - Voice|Spectrum.net||', utilitynav_voice_devices,
                      'view_equipment_details_tv|View Equipment Details Tv|Spectrum.net||', view_equipment_details_tv_devices,
                      'view_equipment_details_voice|View Equipment Details Voice|Spectrum.net||', view_equipment_details_voice_devices,
                      'view_online_statement|View Online Statement|Spectrum.net||', view_online_statement_devices,
                      'view_support_video_tv_view_troubleshooting_video|View Support Video Tv View Troubleshooting Video|Spectrum.net||', view_support_video_tv_view_troubleshooting_video_devices,
                      'view_support_video_voice_view_more_videos|View Support Video Voice View More Videos|Spectrum.net||', view_support_video_voice_view_more_videos_devices,
                      'view_support_video_voice_view_troubleshooting_video|View Support Video Voice View Troubleshooting Video|Spectrum.net||', view_support_video_voice_view_troubleshooting_video_devices,
                      'webmail_views|Webmail Views|Spectrum.net||', webmail_views_devices,
                      'yourservicesequip_internet|Your Services Equipment - Internet|Spectrum.net||', yourservicesequip_internet_devices,
                      'yourservicesequip_mobile|Your Services Equipment - Mobile|Spectrum.net||', yourservicesequip_mobile_devices,
                      'yourservicesequip_tv|Your Services Equipment - TV|Spectrum.net||', yourservicesequip_tv_devices,
                      'yourservicesequip_voice|Your Services Equipment - Voice|Spectrum.net||', yourservicesequip_voice_devices,
                      'equipment_resets_too_many_resets_modal_all|Equipment Resets Too Many Resets Modal|Spectrum.net||', equipment_resets_too_many_resets_modal_all_devices,
                      'equipment_resets_too_many_resets_modal_internet|Equipment Resets Too Many Resets Modal Internet|Spectrum.net||', equipment_resets_too_many_resets_modal_internet_devices,
                      'equipment_resets_too_many_resets_modal_tv|Equipment Resets Too Many Resets Modal TV|Spectrum.net||', equipment_resets_too_many_resets_modal_tv_devices,
                      'equipment_resets_too_many_resets_modal_voice|Equipment Resets Too Many Resets Modal Voice|Spectrum.net||', equipment_resets_too_many_resets_modal_voice_devices,
                      'os_android|Operating System - Android|Spectrum.net||', os_android_devices,
                      'os_ios|Operating System - iOS|Spectrum.net||', os_ios_devices,
                      'os_other|Operating System - Not Android or iOS|Spectrum.net||', os_other_devices
                  ) as map_column
          FROM ${env:TMP_db}.asp_venona_counts_weekly_counts_devices_columns
        ) as derived_table
    LATERAL VIEW EXPLODE (map_column) exploded_table AS metric, value
;
